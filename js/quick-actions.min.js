"use strict";const QuickActions=function(){const e={longPressDuration:500,moveThreshold:10,defaultReactions:["â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ‘"],enableHaptics:!0};let t=null,n=null,o=null,i=null,a=null,c=null,s=null;function r(t="medium"){if(e.enableHaptics)try{if(window.navigator&&window.navigator.vibrate){const e={light:[10],medium:[20],heavy:[30],selection:[5]};window.navigator.vibrate(e[t]||[20])}"Haptics"in window&&window.Haptics.vibrate(t)}catch(e){}}function l(e,t){const n=(o||(o=document.createElement("div"),o.className="long-press-ring",o.setAttribute("aria-hidden","true"),document.body.appendChild(o)),o);n.style.left=e+"px",n.style.top=t+"px",n.classList.add("active")}function u(e,t={}){if(!s)return void v();const n={...s,...t};switch(e){case"copy":d(n);break;case"share":!async function(e){const t={title:e.author?`Post de ${e.author}`:"Cinq",text:e.content||e.preview||"",url:e.url||window.location.href};try{navigator.share?await navigator.share(t):(await d({content:t.url}),m("Lien copiÃ© !","success"))}catch(e){"AbortError"!==e.name&&m("Erreur de partage","error")}}(n);break;case"bookmark":!function(e){p("bookmark",e),m("AjoutÃ© aux favoris â­","success")}(n);break;case"reply":!function(e){p("reply",e)}(n);break;case"react":!function(e){p("react",e),m(e.emoji||"â¤ï¸","success")}(n);break;case"delete":!function(e){p("delete",e)}(n);break;case"edit":!function(e){p("edit",e)}(n);break;case"report":!function(e){p("report",e),m("Signalement envoyÃ©","success")}(n);break;default:p(e,n)}v()}async function d(e){const t=e.content||e.preview||"";try{window.Cinq?.copyToClipboard?await window.Cinq.copyToClipboard(t):navigator.clipboard&&await navigator.clipboard.writeText(t),m("CopiÃ© !","success")}catch(e){m("Erreur de copie","error")}}function p(e,t){const n=new CustomEvent("quickaction",{detail:{action:e,context:t},bubbles:!0});document.dispatchEvent(n)}function m(e,t="success"){window.Cinq?.showToast&&window.Cinq.showToast(e,{type:t,duration:2e3})}function h(o,i,a,c){v(),s=i.context||{},n=function(){const e=document.createElement("div");return e.className="quick-actions-overlay",e.setAttribute("role","presentation"),e.addEventListener("click",v),e}(),t=function(t){const{type:n="post",author:o="",preview:i="",avatar:a="",actions:c=[],reactions:s=null,isOwn:l=!1}=t,d=document.createElement("div");if(d.className="quick-actions-menu "+("message"===n?"message-quick-actions":""),d.setAttribute("role","menu"),d.setAttribute("aria-label","Actions rapides"),o||i){const e=document.createElement("div");if(e.className="quick-actions-header",a){const t=document.createElement("div");t.className="quick-actions-avatar",t.textContent=a,e.appendChild(t)}const t=document.createElement("div");if(t.className="quick-actions-preview",o){const e=document.createElement("div");e.className="quick-actions-author",e.textContent=o+(l?" (toi)":""),t.appendChild(e)}if(i){const e=document.createElement("div");e.className="quick-actions-text",e.textContent=i.length>50?i.slice(0,50)+"â€¦":i,t.appendChild(e)}e.appendChild(t),d.appendChild(e)}if(!1!==s&&"post"===n){const t=document.createElement("div");t.className="quick-reactions-bar",(s||e.defaultReactions).forEach(e=>{const n=document.createElement("button");n.className="quick-reaction-btn",n.textContent=e,n.setAttribute("aria-label",`RÃ©agir avec ${e}`),n.addEventListener("click",()=>{r("light"),u("react",{emoji:e})}),t.appendChild(n)}),d.appendChild(t)}const p=document.createElement("div");p.className="quick-actions-list",c.forEach((e,t)=>{if(e.divider){const e=document.createElement("div");return e.className="quick-actions-divider",e.setAttribute("role","separator"),void p.appendChild(e)}const n=document.createElement("button");n.className="quick-action-item",e.destructive&&n.classList.add("destructive"),n.setAttribute("role","menuitem"),n.setAttribute("tabindex",0===t?"0":"-1"),n.innerHTML=`\n                <span class="quick-action-icon">${e.icon||""}</span>\n                <span class="quick-action-label">${window.Cinq?.escapeHtml(e.label)||e.label}</span>\n                ${e.shortcut?`<span class="quick-action-shortcut">${e.shortcut}</span>`:""}\n            `,n.addEventListener("click",()=>{r("light"),u(e.action,e.data)}),p.appendChild(n)}),d.appendChild(p);const m=document.createElement("button");return m.className="quick-actions-cancel",m.textContent="Annuler",m.addEventListener("click",v),p.appendChild(m),d}(i),document.body.appendChild(n),document.body.appendChild(t),window.innerWidth>640&&void 0!==a&&void 0!==c&&function(e,t,n){const o=e.getBoundingClientRect(),i=16;let a=t,c=n;a+o.width>window.innerWidth-i&&(a=window.innerWidth-o.width-i);c+o.height>window.innerHeight-i&&(c=window.innerHeight-o.height-i);a=Math.max(i,a),c=Math.max(i,c),e.style.left=a+"px",e.style.top=c+"px"}(t,a,c),requestAnimationFrame(()=>{n.classList.add("active"),t.classList.add("active");const e=t.querySelector(".quick-action-item");e&&e.focus()}),document.body.style.overflow="hidden",document.addEventListener("keydown",f),r("medium")}function v(){n&&(n.classList.remove("active"),setTimeout(()=>n?.remove(),200),n=null),t&&(t.classList.remove("active"),setTimeout(()=>t?.remove(),250),t=null),s=null,document.body.style.overflow="",document.removeEventListener("keydown",f)}function f(e){if(!t)return;const n=t.querySelectorAll(".quick-action-item"),o=Array.from(n).indexOf(document.activeElement);switch(e.key){case"Escape":e.preventDefault(),v();break;case"ArrowDown":e.preventDefault();const t=o<n.length-1?o+1:0;n[t]?.focus();break;case"ArrowUp":e.preventDefault();const i=o>0?o-1:n.length-1;n[i]?.focus();break;case"Tab":e.shiftKey||o!==n.length-1?e.shiftKey&&0===o&&(e.preventDefault(),n[n.length-1]?.focus()):(e.preventDefault(),n[0]?.focus())}}function w(){i&&(clearTimeout(i),i=null),c&&(c.classList.remove("pressing"),c=null),o&&o.classList.remove("active"),a=null}function b(t){if(!a)return;const n=t.touches?t.touches[0]:t,o=Math.abs(n.clientX-a.x),i=Math.abs(n.clientY-a.y);(o>e.moveThreshold||i>e.moveThreshold)&&w()}function y(t,n){t&&(t.classList.add("long-press-target"),t.addEventListener("touchstart",o=>{o.target.closest('a, button, input, textarea, select, [role="button"]')||function(t,n,o){const s=n.touches?n.touches[0]:n;a={x:s.clientX,y:s.clientY},c=t,t.classList.add("pressing"),l(s.clientX,s.clientY),i=setTimeout(()=>{h(0,"function"==typeof o?o(t):o,s.clientX,s.clientY),w()},e.longPressDuration)}(t,o,n)},{passive:!0}),t.addEventListener("touchmove",b,{passive:!0}),t.addEventListener("touchend",w),t.addEventListener("touchcancel",w),t.addEventListener("contextmenu",e=>{e.preventDefault();h(0,"function"==typeof n?n(t):n,e.clientX,e.clientY)}))}function g(e,t){document.querySelectorAll(e).forEach(e=>y(e,t))}function k(e=!1){const t=[{icon:"ðŸ“‹",label:"Copier le texte",action:"copy"},{icon:"ðŸ”—",label:"Partager",action:"share"},{icon:"â­",label:"Ajouter aux favoris",action:"bookmark"}];return e?(t.push({divider:!0}),t.push({icon:"âœï¸",label:"Modifier",action:"edit"}),t.push({icon:"ðŸ—‘ï¸",label:"Supprimer",action:"delete",destructive:!0})):(t.push({divider:!0}),t.push({icon:"ðŸš©",label:"Signaler",action:"report"})),t}function x(e=!1){const t=[{icon:"â†©ï¸",label:"RÃ©pondre",action:"reply"},{icon:"ðŸ“‹",label:"Copier",action:"copy"}];return e&&(t.push({divider:!0}),t.push({icon:"ðŸ—‘ï¸",label:"Supprimer",action:"delete",destructive:!0})),t}function q(){g(".post-card",e=>{const t=e.dataset.postId||e.id?.replace("post-",""),n=e.querySelector(".post-author-name")?.textContent||"Utilisateur",o=e.querySelector(".post-content")?.textContent||"",i=e.querySelector(".post-avatar")?.textContent||n.charAt(0).toUpperCase(),a=null!==e.querySelector(".you-badge")||"true"===e.dataset.own;return{type:"post",author:n.replace(" (toi)",""),preview:o,avatar:i,isOwn:a,actions:k(a),context:{id:t,content:o,author:n}}})}function C(){g(".message",e=>{const t=e.id?.replace("msg-","")||e.dataset.msgId,n=e.querySelector(".message-text, p")?.textContent||"",o=e.classList.contains("text-right")||"true"===e.dataset.mine;return{type:"message",preview:n,isOwn:o,reactions:!1,actions:x(o),context:{id:t,content:n,isOwn:o}}})}function E(){"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0||(e.longPressDuration=0),document.querySelector(".post-card")&&q(),document.querySelector(".message")&&C();new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{1===e.nodeType&&(e.classList?.contains("post-card")?y(e,L):e.classList?.contains("message")&&y(e,A),e.querySelectorAll?.(".post-card, .message").forEach(e=>{e.classList.contains("post-card")?y(e,L):y(e,A)}))})})}).observe(document.body,{childList:!0,subtree:!0})}function L(e){const t=e.dataset.postId||e.id?.replace("post-",""),n=e.querySelector(".post-author-name")?.textContent||"Utilisateur",o=e.querySelector(".post-content")?.textContent||"",i=e.querySelector(".post-avatar")?.textContent||n.charAt(0).toUpperCase(),a=null!==e.querySelector(".you-badge")||"true"===e.dataset.own;return{type:"post",author:n.replace(" (toi)",""),preview:o,avatar:i,isOwn:a,actions:k(a),context:{id:t,content:o,author:n}}}function A(e){const t=e.id?.replace("msg-","")||e.dataset.msgId,n=e.querySelector(".message-text, p")?.textContent||"",o=e.classList.contains("text-right")||"true"===e.dataset.mine;return{type:"message",preview:n,isOwn:o,reactions:!1,actions:x(o),context:{id:t,content:n,isOwn:o}}}return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",E):E(),{show:h,hide:v,enable:y,enableAll:g,initPosts:q,initMessages:C,getPostActions:k,getMessageActions:x,config:e}}();"undefined"!=typeof module&&module.exports&&(module.exports=QuickActions),window.QuickActions=QuickActions;