<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Activer mon code cadeau ‚Äî Cinq</title>
    
    <!-- SEO -->
    <meta name="description" content="Activez votre code cadeau Cinq et rejoignez l'anti-r√©seau social. 5 personnes. Pas 500.">
    <meta name="keywords" content="cinq, cadeau, activation, r√©seau social, anti social">
    <meta name="author" content="Cinq">
    
    <!-- Canonical -->
    <link rel="canonical" href="https://cinq.app/redeem">
    
    <!-- Open Graph -->
    <meta property="og:title" content="üéÅ Activer mon code cadeau ‚Äî Cinq">
    <meta property="og:description" content="Tu as re√ßu un code cadeau Cinq ? Active-le ici et rejoins l'anti-r√©seau social.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://cinq.app/redeem">
    <meta property="og:image" content="https://cinq.app/og-redeem.png">
    <meta property="og:site_name" content="Cinq">
    <meta property="og:locale" content="fr_FR">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="üéÅ Activer mon code Cinq">
    <meta name="twitter:description" content="5 personnes. Pas 500. Active ton acc√®s.">
    <meta name="twitter:image" content="https://cinq.app/og-redeem.png">
    <meta name="twitter:site" content="@cinqapp">
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "Activer mon code cadeau ‚Äî Cinq",
        "description": "Activez votre code cadeau Cinq et rejoignez l'anti-r√©seau social.",
        "url": "https://cinq.app/redeem",
        "isPartOf": {
            "@type": "WebSite",
            "name": "Cinq",
            "url": "https://cinq.app"
        },
        "mainEntity": {
            "@type": "Action",
            "name": "Activer un code cadeau",
            "description": "Utilisez votre code cadeau pour cr√©er votre compte Cinq"
        }
    }
    </script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/icon-192x192.png">
    <meta name="theme-color" content="#0e0e12" id="theme-color-meta">
    
    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Cinq">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap"></noscript>
    
    <!-- Design System -->
    <link rel="stylesheet" href="/design/styles.min.css">
    <link rel="stylesheet" href="/css/mobile-responsive.min.css">
    <link rel="stylesheet" href="/css/a11y.min.css">
    
    <!-- Theme CSS for smooth transitions -->
    <link rel="stylesheet" href="/css/theme.min.css">
    
    <!-- Theme initialization -->
    <script>
        (function(){var h=document.documentElement,s=localStorage.getItem('cinq_theme'),p=s||'dark',t=p;if(p==='auto'){t=window.matchMedia&&window.matchMedia('(prefers-color-scheme:light)').matches?'light':'dark'}h.setAttribute('data-theme',t);h.setAttribute('data-theme-preference',p);h.classList.add('theme-loading');var m=document.getElementById('theme-color-meta');if(m)m.content=t==='light'?'#faf9f7':'#0e0e12';var a=localStorage.getItem('cinq_accent')||'indigo';h.setAttribute('data-accent',a)})();
        var THEMES=['dark','light','auto'];
        function getSystemPref(){return window.matchMedia&&window.matchMedia('(prefers-color-scheme:light)').matches?'light':'dark'}
        function getEffective(p){return p==='auto'?getSystemPref():(p||'dark')}
        function toggleTheme(){var h=document.documentElement,c=localStorage.getItem('cinq_theme')||'dark',n=THEMES[(THEMES.indexOf(c)+1)%3],e=getEffective(n);h.classList.add('theme-transitioning');h.setAttribute('data-theme',e);h.setAttribute('data-theme-preference',n);localStorage.setItem('cinq_theme',n);var m=document.getElementById('theme-color-meta');if(m)m.content=e==='light'?'#faf9f7':'#0e0e12';setTimeout(function(){h.classList.remove('theme-transitioning')},400)}
        requestAnimationFrame(function(){requestAnimationFrame(function(){document.documentElement.classList.remove('theme-loading')})});
    </script>
    
    <!-- Analytics -->
    <script defer src="/analytics.js"></script>
    
    <style>
        /* ===== LAYOUT ===== */
        .redeem-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--space-5);
        }
        
        @media (max-width: 380px) {
            .redeem-container {
                padding: var(--space-4);
            }
        }
        
        /* ===== SCREENS ===== */
        .screen {
            width: 100%;
            max-width: 450px;
            animation: screen-enter 0.35s var(--ease-out-expo);
        }
        
        @keyframes screen-enter {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .screen.hidden {
            display: none;
        }
        
        /* ===== LOGO ===== */
        .redeem-logo {
            display: flex;
            justify-content: center;
            margin-bottom: var(--space-6);
        }
        
        .logo-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--color-bg-secondary);
            box-shadow: var(--shadow-glow-sm);
            transition: transform 0.3s var(--ease-spring);
        }
        
        .logo-circle:hover {
            transform: scale(1.05);
        }
        
        .logo-circle svg {
            width: 44px;
            height: 44px;
            stroke: var(--color-brand);
        }
        
        /* Success state */
        .logo-circle.success {
            border-color: var(--color-success);
            box-shadow: 0 0 40px rgba(34, 197, 94, 0.3);
            animation: success-pop 0.5s var(--ease-spring);
        }
        
        @keyframes success-pop {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* ===== TITLES ===== */
        .redeem-title {
            font-family: var(--font-display);
            font-size: var(--text-2xl);
            font-weight: 700;
            text-align: center;
            margin-bottom: var(--space-3);
            letter-spacing: -0.02em;
        }
        
        .redeem-subtitle {
            font-size: var(--text-base);
            color: var(--color-text-muted);
            text-align: center;
            margin-bottom: var(--space-6);
        }
        
        /* ===== FORM ELEMENTS ===== */
        .form-group {
            margin-bottom: var(--space-5);
        }
        
        .form-label {
            display: block;
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--color-text-secondary);
            margin-bottom: var(--space-2);
        }
        
        .form-input {
            width: 100%;
            padding: var(--space-4);
            background: var(--color-bg-tertiary);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-xl);
            color: var(--color-text-primary);
            font-size: var(--text-lg);
            transition: all 0.2s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--color-brand);
            box-shadow: 0 0 0 4px var(--color-brand-muted);
        }
        
        .form-input::placeholder {
            color: var(--color-text-muted);
        }
        
        .form-input.error {
            border-color: var(--color-error);
            box-shadow: 0 0 0 4px var(--color-error-muted);
        }
        
        .form-input.valid {
            border-color: var(--color-success);
        }
        
        /* Code input specifics */
        .code-input {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            text-align: center;
        }
        
        .code-input::placeholder {
            text-transform: none;
            letter-spacing: normal;
        }
        
        /* Password input */
        .password-field {
            position: relative;
        }
        
        .password-toggle {
            position: absolute;
            right: var(--space-4);
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--color-text-muted);
            cursor: pointer;
            padding: var(--space-1);
            transition: color 0.2s;
        }
        
        .password-toggle:hover {
            color: var(--color-text-primary);
        }
        
        .password-field .form-input {
            padding-right: var(--space-12);
        }
        
        /* Form hint */
        .form-hint {
            font-size: var(--text-xs);
            color: var(--color-text-muted);
            margin-top: var(--space-2);
            text-align: center;
        }
        
        /* Field error */
        .field-error {
            font-size: var(--text-xs);
            color: var(--color-error);
            margin-top: var(--space-2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-1);
            animation: error-shake 0.4s ease-out;
        }
        
        @keyframes error-shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-4px); }
            40%, 80% { transform: translateX(4px); }
        }
        
        .field-error.hidden {
            display: none;
        }
        
        /* Password strength */
        .password-strength {
            margin-top: var(--space-3);
        }
        
        .strength-bar {
            height: 4px;
            background: var(--color-bg-tertiary);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-bottom: var(--space-1);
        }
        
        .strength-fill {
            height: 100%;
            width: 0%;
            transition: width 0.3s, background 0.3s;
            border-radius: inherit;
        }
        
        .strength-fill.weak { width: 25%; background: var(--color-error); }
        .strength-fill.fair { width: 50%; background: var(--color-warning); }
        .strength-fill.good { width: 75%; background: #22c55e; }
        .strength-fill.strong { width: 100%; background: var(--color-success); }
        
        .strength-text {
            font-size: var(--text-xs);
            color: var(--color-text-muted);
            text-align: right;
        }
        
        .strength-text.weak { color: var(--color-error); }
        .strength-text.fair { color: var(--color-warning); }
        .strength-text.good { color: #22c55e; }
        .strength-text.strong { color: var(--color-success); }
        
        /* Terms checkbox */
        .terms-group {
            display: flex;
            align-items: flex-start;
            gap: var(--space-3);
            margin-bottom: var(--space-5);
        }
        
        .terms-checkbox {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            accent-color: var(--color-brand);
            cursor: pointer;
        }
        
        .terms-label {
            font-size: var(--text-sm);
            color: var(--color-text-muted);
            line-height: 1.5;
        }
        
        .terms-label a {
            color: var(--color-brand);
            text-decoration: none;
        }
        
        .terms-label a:hover {
            text-decoration: underline;
        }
        
        /* ===== SUBMIT BUTTON ===== */
        .submit-btn {
            width: 100%;
            padding: var(--space-4);
            background: var(--cinq-gradient);
            color: white;
            border: none;
            border-radius: var(--radius-xl);
            font-family: var(--font-display);
            font-size: var(--text-base);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s var(--ease-spring);
            box-shadow: var(--shadow-glow-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-3);
            position: relative;
            overflow: hidden;
        }
        
        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .submit-btn:hover:not(:disabled)::before {
            left: 100%;
        }
        
        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px) scale(1.01);
            box-shadow: var(--shadow-glow);
        }
        
        .submit-btn:active:not(:disabled) {
            transform: translateY(0) scale(0.98);
        }
        
        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* Loading state */
        .loading-dots {
            display: flex;
            gap: var(--space-1);
        }
        
        .loading-dots span {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: loading-pulse 1.4s ease-in-out infinite;
        }
        
        .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
        .loading-dots span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes loading-pulse {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        
        /* ===== CODE INFO BOX ===== */
        .code-info {
            background: var(--color-bg-tertiary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            margin-bottom: var(--space-5);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .code-info-label {
            font-size: var(--text-xs);
            color: var(--color-text-muted);
        }
        
        .code-info-value {
            font-family: 'Monaco', 'Menlo', monospace;
            color: var(--color-brand);
            font-weight: 500;
        }
        
        /* ===== BACK BUTTON ===== */
        .back-btn {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            color: var(--color-text-muted);
            font-size: var(--text-sm);
            margin-bottom: var(--space-6);
            cursor: pointer;
            background: none;
            border: none;
            padding: var(--space-2);
            margin-left: calc(-1 * var(--space-2));
            border-radius: var(--radius-lg);
            transition: all 0.2s;
        }
        
        .back-btn:hover {
            color: var(--color-text-primary);
            background: var(--color-bg-tertiary);
        }
        
        /* ===== SECONDARY LINKS ===== */
        .secondary-link {
            text-align: center;
            margin-top: var(--space-6);
        }
        
        .secondary-link a {
            color: var(--color-text-muted);
            font-size: var(--text-sm);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .secondary-link a:hover {
            color: var(--color-brand);
        }
        
        .secondary-link a span {
            text-decoration: underline;
        }
        
        /* ===== SUCCESS SCREEN ===== */
        .success-title {
            color: var(--color-success);
        }
        
        .success-info {
            background: var(--color-bg-tertiary);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: var(--radius-2xl);
            padding: var(--space-5);
            margin-bottom: var(--space-6);
        }
        
        .success-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-2) 0;
        }
        
        .success-info-row:not(:last-child) {
            border-bottom: 1px solid var(--color-border);
        }
        
        .success-info-label {
            color: var(--color-text-muted);
            font-size: var(--text-sm);
        }
        
        .success-info-value {
            font-weight: 500;
        }
        
        .success-info-value.highlight {
            color: var(--color-success);
        }
        
        /* Redirect notice */
        .redirect-notice {
            text-align: center;
            color: var(--color-text-muted);
            font-size: var(--text-sm);
            margin-bottom: var(--space-5);
            padding: var(--space-4);
            background: var(--color-bg-tertiary);
            border-radius: var(--radius-lg);
        }
        
        .redirect-timer {
            font-weight: 600;
            color: var(--color-brand);
        }
        
        /* Login prompt */
        .login-prompt {
            background: var(--color-brand-muted);
            border: 1px solid rgba(255, 107, 74, 0.3);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            margin-bottom: var(--space-6);
            display: flex;
            gap: var(--space-3);
            align-items: flex-start;
        }
        
        .login-prompt-icon {
            font-size: 1.25rem;
            flex-shrink: 0;
        }
        
        .login-prompt-title {
            font-weight: 500;
            margin-bottom: var(--space-1);
        }
        
        .login-prompt-text {
            font-size: var(--text-sm);
            color: var(--color-text-muted);
        }
        
        /* ===== ERROR SCREEN ===== */
        .error-title {
            color: var(--color-error);
        }
        
        .error-detail {
            background: var(--color-error-muted);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            margin-bottom: var(--space-6);
            color: var(--color-error);
            font-size: var(--text-sm);
        }
        
        .retry-btn {
            width: 100%;
            padding: var(--space-4);
            background: var(--color-bg-tertiary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            color: var(--color-text-primary);
            font-family: var(--font-display);
            font-size: var(--text-base);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            transition: all 0.15s var(--ease-spring);
        }
        
        .retry-btn:hover {
            background: var(--color-bg-elevated);
            border-color: var(--color-border-active);
        }
        
        .support-link {
            text-align: center;
            margin-top: var(--space-6);
            font-size: var(--text-sm);
            color: var(--color-text-muted);
        }
        
        .support-link a {
            color: var(--color-brand);
            text-decoration: none;
        }
        
        .support-link a:hover {
            text-decoration: underline;
        }
        
        /* ===== THEME TOGGLE ===== */
        .theme-toggle {
            position: fixed;
            top: var(--space-4);
            right: var(--space-4);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: var(--color-bg-tertiary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
        }
        
        .theme-toggle:hover {
            background: var(--color-bg-elevated);
            transform: scale(1.05);
        }
        
        .theme-toggle .icon-sun,
        .theme-toggle .icon-moon {
            position: absolute;
            transition: all 0.3s var(--ease-spring);
            color: var(--color-text-secondary);
        }
        
        .theme-toggle .icon-sun { opacity: 1; transform: rotate(0) scale(1); }
        .theme-toggle .icon-moon { opacity: 0; transform: rotate(-90deg) scale(0.5); }
        
        [data-theme="light"] .theme-toggle .icon-sun { opacity: 0; transform: rotate(90deg) scale(0.5); }
        [data-theme="light"] .theme-toggle .icon-moon { opacity: 1; transform: rotate(0) scale(1); }
        
        /* ===== BACKGROUND ===== */
        .bg-orbs {
            position: fixed;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
            z-index: -1;
        }
        
        .bg-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.15;
            animation: orb-float 6s ease-in-out infinite;
        }
        
        @keyframes orb-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .bg-orb-1 {
            width: 350px;
            height: 350px;
            background: var(--color-brand);
            top: -100px;
            left: -100px;
        }
        
        .bg-orb-2 {
            width: 300px;
            height: 300px;
            background: #a78bfa;
            top: 50%;
            right: -100px;
            animation-delay: -2s;
        }
        
        .bg-orb-3 {
            width: 250px;
            height: 250px;
            background: #3b82f6;
            bottom: -80px;
            left: 30%;
            animation-delay: -4s;
        }
        
        /* ===== SR ONLY ===== */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* ===== REDUCED MOTION ===== */
        @media (prefers-reduced-motion: reduce) {
            .screen,
            .logo-circle.success,
            .bg-orb,
            .loading-dots span {
                animation: none !important;
            }
            
            .submit-btn::before {
                display: none;
            }
        }
    </style>
    <script defer src="/fun.js"></script>
</head>
<body style="display: flex; flex-direction: column; min-height: 100vh; min-height: 100dvh;">
    <!-- Skip Links - WCAG AAA Compliant -->
    <nav class="skip-links" aria-label="Liens d'√©vitement">
        <a href="#main-content" class="skip-link">Aller au contenu principal</a>
        <a href="#redeem-code" class="skip-link">Aller au formulaire de code</a>
    </nav>
    
    <!-- Live region for dynamic announcements -->
    <div id="sr-announce" class="sr-announce" aria-live="polite" aria-atomic="true"></div>
    
    <!-- Theme Toggle -->
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Basculer mode clair/sombre">
        <svg class="icon-sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
        <svg class="icon-moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
    </button>
    
    <!-- Background orbs -->
    <div class="bg-orbs" aria-hidden="true">
        <div class="bg-orb bg-orb-1"></div>
        <div class="bg-orb bg-orb-2"></div>
        <div class="bg-orb bg-orb-3"></div>
    </div>

    <!-- Screen reader announcements -->
    <div id="sr-announcements" class="sr-only" aria-live="assertive" aria-atomic="true"></div>

    <main id="main-content" class="redeem-container" role="main">
        
        <!-- ==========================================
             SCREEN 1: Code Entry
             ========================================== -->
        <section id="screen-code" class="screen" aria-labelledby="code-title">
            <div class="redeem-logo">
                <div class="logo-circle" aria-hidden="true">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="8" width="18" height="13" rx="2"/><path d="M12 8v13"/><path d="M3 12h18"/><path d="M12 8c-2.5-3-6-2-6 0s3.5 2 6 0"/><path d="M12 8c2.5-3 6-2 6 0s-3.5 2-6 0"/>
                    </svg>
                </div>
            </div>
            
            <h1 id="code-title" class="redeem-title">Tu as re√ßu un cadeau</h1>
            <p class="redeem-subtitle">Entre ton code pour activer ton acc√®s √† <strong>Cinq</strong></p>
            
            <form id="code-form" onsubmit="CinqRedeem.verifyCode(event)">
                <div class="form-group">
                    <label for="gift-code" class="form-label">Code cadeau</label>
                    <input 
                        type="text" 
                        id="gift-code"
                        name="code"
                        class="form-input code-input"
                        placeholder="CINQ-XXXX-XXXX-XXXX"
                        maxlength="19"
                        autocomplete="off"
                        autocapitalize="characters"
                        spellcheck="false"
                        oninput="CinqRedeem.formatCode(this)"
                        aria-describedby="code-hint code-error"
                        required
                    >
                    <p id="code-hint" class="form-hint">Format: CINQ-XXXX-XXXX-XXXX</p>
                    <p id="code-error" class="field-error hidden" role="alert"></p>
                </div>
                
                <button type="submit" id="verify-btn" class="submit-btn">
                    <span aria-hidden="true">üîì</span>
                    <span id="verify-btn-text">Activer mon acc√®s</span>
                </button>
            </form>
            
            <div class="secondary-link">
                <a href="/gift.html">Pas encore de code ? <span>Acheter un acc√®s ‚Üí</span></a>
            </div>
        </section>

        <!-- ==========================================
             SCREEN 2: Account Creation
             ========================================== -->
        <section id="screen-email" class="screen hidden" aria-labelledby="email-title">
            <button onclick="CinqRedeem.showScreen('code')" class="back-btn" aria-label="Retour">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
                Retour
            </button>
            
            <div class="redeem-logo">
                <div class="logo-circle" aria-hidden="true">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                    </svg>
                </div>
            </div>
            
            <h2 id="email-title" class="redeem-title">Cr√©e ton compte</h2>
            <p class="redeem-subtitle">Une derni√®re √©tape pour activer ton acc√®s</p>
            
            <div class="code-info" id="code-info">
                <span class="code-info-label">Code cadeau</span>
                <span class="code-info-value" id="verified-code"></span>
            </div>
            
            <form id="email-form" onsubmit="CinqRedeem.createAccount(event)">
                <div class="form-group">
                    <label for="user-email" class="form-label">Ton adresse email</label>
                    <input 
                        type="email" 
                        id="user-email"
                        name="email"
                        class="form-input"
                        placeholder="ton@email.com"
                        autocomplete="email"
                        aria-describedby="email-error"
                        required
                    >
                    <p id="email-error" class="field-error hidden" role="alert"></p>
                </div>
                
                <div class="form-group">
                    <label for="user-password" class="form-label">Choisis un mot de passe</label>
                    <div class="password-field">
                        <input 
                            type="password" 
                            id="user-password"
                            name="password"
                            class="form-input"
                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                            autocomplete="new-password"
                            minlength="8"
                            aria-describedby="password-hint password-error"
                            required
                        >
                        <button type="button" class="password-toggle" onclick="CinqRedeem.togglePassword()" aria-label="Afficher le mot de passe" id="password-toggle-btn">
                            <svg id="eye-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                            <svg id="eye-off-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
                        </button>
                    </div>
                    
                    <div class="password-strength" id="password-strength" style="display: none;">
                        <div class="strength-bar">
                            <div class="strength-fill" id="strength-fill"></div>
                        </div>
                        <div class="strength-text" id="strength-text">Faible</div>
                    </div>
                    
                    <p id="password-hint" class="form-hint">Minimum 8 caract√®res, avec 1 lettre et 1 chiffre</p>
                    <p id="password-error" class="field-error hidden" role="alert"></p>
                </div>
                
                <div class="terms-group">
                    <input type="checkbox" id="accept-terms" name="terms" class="terms-checkbox" required>
                    <label for="accept-terms" class="terms-label">
                        J'accepte les <a href="/terms.html" target="_blank">conditions d'utilisation</a> 
                        et la <a href="/privacy.html" target="_blank">politique de confidentialit√©</a>
                    </label>
                </div>
                
                <button type="submit" id="create-btn" class="submit-btn">
                    <span aria-hidden="true">üöÄ</span>
                    <span id="create-btn-text">Cr√©er mon compte</span>
                </button>
            </form>
            
            <div class="secondary-link">
                Tu as d√©j√† un compte ? <a href="/login.html">Connecte-toi</a>
            </div>
        </section>

        <!-- ==========================================
             SCREEN 3: Success
             ========================================== -->
        <section id="screen-success" class="screen hidden" aria-labelledby="success-title">
            <div class="redeem-logo">
                <div class="logo-circle success" aria-hidden="true">
                    <svg viewBox="0 0 24 24" fill="none" stroke="var(--color-success)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                    </svg>
                </div>
            </div>
            
            <h2 id="success-title" class="redeem-title success-title">Bienvenue dans le cercle ! üíú</h2>
            <p class="redeem-subtitle">Ton compte est pr√™t. Maintenant, choisis bien tes 5.<br><small style="opacity: 0.7;">(Pas de pression. Ou un peu.)</small></p>
            
            <div class="success-info">
                <div class="success-info-row">
                    <span class="success-info-label">Email</span>
                    <span class="success-info-value" id="success-email"></span>
                </div>
                <div class="success-info-row">
                    <span class="success-info-label">Acc√®s</span>
                    <span class="success-info-value highlight">‚úì Activ√© √† vie</span>
                </div>
            </div>
            
            <div class="login-prompt">
                <span class="login-prompt-icon">üîê</span>
                <div>
                    <p class="login-prompt-title">Ton compte est pr√™t</p>
                    <p class="login-prompt-text">Tu peux maintenant te connecter avec ton email et mot de passe.</p>
                </div>
            </div>
            
            <div class="redirect-notice" id="redirect-notice">
                Redirection automatique dans <span class="redirect-timer" id="redirect-timer">5</span>s...
            </div>
            
            <a href="/login.html" id="go-app-btn" class="submit-btn">
                Se connecter ‚Üí
            </a>
            
            <div class="secondary-link">
                <a href="/">‚Üê Retour √† l'accueil</a>
            </div>
        </section>

        <!-- ==========================================
             SCREEN 4: Error
             ========================================== -->
        <section id="screen-error" class="screen hidden" aria-labelledby="error-title">
            <div class="redeem-logo">
                <div class="logo-circle" aria-hidden="true" style="border-color: var(--color-error);">
                    <span style="font-size: 2.5rem;">üòï</span>
                </div>
            </div>
            
            <h2 id="error-title" class="redeem-title error-title">Oups, un probl√®me</h2>
            <p id="error-message" class="redeem-subtitle">Une erreur s'est produite</p>
            
            <div id="error-detail" class="error-detail"></div>
            
            <button onclick="CinqRedeem.showScreen('code')" class="retry-btn">
                <span>‚Üª</span>
                <span>R√©essayer</span>
            </button>
            
            <p class="support-link">
                Besoin d'aide ? <a href="mailto:support@cinq.app">Contacte le support</a>
            </p>
        </section>

    </main>

    <!-- JavaScript -->
    <script>
        const CinqRedeem = (function() {
            'use strict';
            
            const API_BASE = '/.netlify/functions';
            const CODE_PATTERN = /^CINQ-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/;
            const REDIRECT_DELAY = 5;
            
            let _state = {
                verifiedCode: null,
                redirectTimer: null,
                isPasswordVisible: false
            };
            
            // Utilities
            function announce(message) {
                const el = document.getElementById('sr-announcements');
                if (el) el.textContent = message;
            }
            
            function showError(elementId, message) {
                const el = document.getElementById(elementId);
                if (el) {
                    el.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg> ${message}`;
                    el.classList.remove('hidden');
                }
            }
            
            function hideError(elementId) {
                const el = document.getElementById(elementId);
                if (el) el.classList.add('hidden');
            }
            
            // Navigation
            function showScreen(screenName) {
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.add('hidden');
                    screen.setAttribute('aria-hidden', 'true');
                });
                
                const targetScreen = document.getElementById(`screen-${screenName}`);
                if (targetScreen) {
                    targetScreen.classList.remove('hidden');
                    targetScreen.setAttribute('aria-hidden', 'false');
                    
                    setTimeout(() => {
                        const focusable = targetScreen.querySelector('input, button, a');
                        if (focusable) focusable.focus();
                    }, 100);
                }
                
                if (screenName !== 'success' && _state.redirectTimer) {
                    clearInterval(_state.redirectTimer);
                    _state.redirectTimer = null;
                }
            }
            
            // Code formatting
            function formatCode(input) {
                let value = input.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
                
                let formatted = '';
                if (value.length > 0) {
                    formatted = value.slice(0, 4);
                    if (value.length > 4) formatted += '-' + value.slice(4, 8);
                    if (value.length > 8) formatted += '-' + value.slice(8, 12);
                    if (value.length > 12) formatted += '-' + value.slice(12, 16);
                }
                
                input.value = formatted;
                
                const isComplete = formatted.length === 19;
                const isValid = CODE_PATTERN.test(formatted);
                
                input.classList.remove('valid', 'error');
                if (isComplete) {
                    input.classList.add(isValid ? 'valid' : 'error');
                }
                
                hideError('code-error');
            }
            
            // Toggle password visibility
            function togglePassword() {
                const passwordInput = document.getElementById('user-password');
                const eyeIcon = document.getElementById('eye-icon');
                const eyeOffIcon = document.getElementById('eye-off-icon');
                const toggleBtn = document.getElementById('password-toggle-btn');
                
                _state.isPasswordVisible = !_state.isPasswordVisible;
                passwordInput.type = _state.isPasswordVisible ? 'text' : 'password';
                eyeIcon.style.display = _state.isPasswordVisible ? 'none' : 'block';
                eyeOffIcon.style.display = _state.isPasswordVisible ? 'block' : 'none';
                toggleBtn.setAttribute('aria-label', _state.isPasswordVisible ? 'Masquer le mot de passe' : 'Afficher le mot de passe');
            }
            
            // Password strength
            function checkPasswordStrength(password) {
                let score = 0;
                
                if (password.length >= 8) score++;
                if (password.length >= 12) score++;
                if (/[a-z]/.test(password) && /[A-Z]/.test(password)) score++;
                if (/\d/.test(password)) score++;
                if (/[^a-zA-Z0-9]/.test(password)) score++;
                
                if (score <= 1) return { class: 'weak', text: 'Faible' };
                if (score === 2) return { class: 'fair', text: 'Moyen' };
                if (score === 3) return { class: 'good', text: 'Bon' };
                return { class: 'strong', text: 'Fort' };
            }
            
            // Verify code
            async function verifyCode(event) {
                event.preventDefault();
                
                const codeInput = document.getElementById('gift-code');
                const code = codeInput.value.trim().toUpperCase();
                
                if (!CODE_PATTERN.test(code)) {
                    codeInput.classList.add('error');
                    showError('code-error', 'Format invalide. Le code doit √™tre au format CINQ-XXXX-XXXX-XXXX');
                    announce('Format de code invalide');
                    return;
                }
                
                hideError('code-error');
                _state.verifiedCode = code;
                document.getElementById('verified-code').textContent = code;
                showScreen('email');
                announce('Entrez votre email et mot de passe pour cr√©er votre compte.');
            }
            
            // Create account
            async function createAccount(event) {
                event.preventDefault();
                
                const emailInput = document.getElementById('user-email');
                const passwordInput = document.getElementById('user-password');
                const termsCheckbox = document.getElementById('accept-terms');
                const email = emailInput.value.trim().toLowerCase();
                const password = passwordInput.value;
                
                hideError('email-error');
                hideError('password-error');
                
                // Validation
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    showError('email-error', 'Adresse email invalide');
                    emailInput.focus();
                    return;
                }
                
                if (password.length < 8) {
                    showError('password-error', 'Le mot de passe doit contenir au moins 8 caract√®res');
                    passwordInput.focus();
                    return;
                }
                
                if (!/\d/.test(password) || !/[a-zA-Z]/.test(password)) {
                    showError('password-error', 'Le mot de passe doit contenir au moins une lettre et un chiffre');
                    passwordInput.focus();
                    return;
                }
                
                if (!termsCheckbox.checked) {
                    showError('email-error', 'Tu dois accepter les conditions d\'utilisation');
                    return;
                }
                
                // UI loading
                const btn = document.getElementById('create-btn');
                const btnText = document.getElementById('create-btn-text');
                
                btn.disabled = true;
                btnText.innerHTML = '<span class="loading-dots"><span></span><span></span><span></span></span> Cr√©ation...';
                
                try {
                    const response = await fetch(`${API_BASE}/auth-register`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            email: email,
                            password: password,
                            giftCode: _state.verifiedCode
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(data.error || 'Erreur lors de la cr√©ation du compte');
                    }
                    
                    document.getElementById('success-email').textContent = email;
                    showScreen('success');
                    announce('Compte cr√©√© avec succ√®s ! Tu peux maintenant te connecter.');
                    
                    if (typeof launchConfetti === 'function') {
                        launchConfetti({ particleCount: 150, spread: 100 });
                    }
                    
                    startRedirectCountdown();
                    
                } catch (error) {
                    btn.disabled = false;
                    btnText.innerHTML = 'üöÄ Cr√©er mon compte';
                    
                    const errorMsg = error.message.toLowerCase();
                    if (errorMsg.includes('code') || errorMsg.includes('gift')) {
                        showScreen('code');
                        showError('code-error', error.message);
                    } else if (errorMsg.includes('email') || errorMsg.includes('account')) {
                        showError('email-error', error.message);
                    } else if (errorMsg.includes('password')) {
                        showError('password-error', error.message);
                    } else {
                        document.getElementById('error-message').textContent = 'Impossible de cr√©er ton compte';
                        document.getElementById('error-detail').textContent = error.message;
                        showScreen('error');
                    }
                    announce('Erreur: ' + error.message);
                }
            }
            
            // Redirect countdown
            function startRedirectCountdown() {
                let seconds = REDIRECT_DELAY;
                const timerEl = document.getElementById('redirect-timer');
                
                _state.redirectTimer = setInterval(() => {
                    seconds--;
                    timerEl.textContent = seconds;
                    
                    if (seconds <= 0) {
                        clearInterval(_state.redirectTimer);
                        window.location.href = '/login.html';
                    }
                }, 1000);
            }
            
            // Initialize
            function init() {
                const urlParams = new URLSearchParams(window.location.search);
                const codeParam = urlParams.get('code');
                
                if (codeParam) {
                    const codeInput = document.getElementById('gift-code');
                    codeInput.value = codeParam.toUpperCase();
                    formatCode(codeInput);
                }
                
                // Password strength listener
                document.getElementById('user-password').addEventListener('input', function() {
                    hideError('password-error');
                    
                    const strengthMeter = document.getElementById('password-strength');
                    const strengthFill = document.getElementById('strength-fill');
                    const strengthText = document.getElementById('strength-text');
                    
                    if (this.value.length > 0) {
                        strengthMeter.style.display = 'block';
                        const strength = checkPasswordStrength(this.value);
                        
                        strengthFill.className = 'strength-fill ' + strength.class;
                        strengthText.className = 'strength-text ' + strength.class;
                        strengthText.textContent = strength.text;
                    } else {
                        strengthMeter.style.display = 'none';
                    }
                });
                
                document.getElementById('gift-code').focus();
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
            
            return {
                showScreen,
                formatCode,
                verifyCode,
                createAccount,
                togglePassword
            };
            
        })();
    </script>
    
    <!-- PWA Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .catch(err => console.log('[PWA] SW registration failed:', err));
            });
        }
    </script>
    <!-- Easter Eggs ü•ö -->
    <script src="/js/easter-eggs.min.js" defer></script>
</body>
</html>
