"use strict";const CinqVoiceTranscription=function(){const n=["fr-FR","en-US","es-ES","de-DE"],e=!0,t=!0,r=1;let i=null,o=!1,c=!1,s="",a="",l=null,p=null;function u(){const n=window.SpeechRecognition||window.webkitSpeechRecognition;return o=!!n,o||console.warn("[VoiceTranscription] Web Speech API not supported in this browser"),o}function d(o={}){if(!u())return!1;const c=window.SpeechRecognition||window.webkitSpeechRecognition;return i=new c,i.continuous=o.continuous??e,i.interimResults=o.interimResults??t,i.maxAlternatives=o.maxAlternatives??r,i.lang=o.lang||n[0],i.onstart=g,i.onend=f,i.onresult=v,i.onerror=m,i.onnomatch=w,console.log("[VoiceTranscription] Initialized with language:",i.lang),!0}function g(){c=!0,console.log("[VoiceTranscription] Recognition started")}function f(){c=!1,console.log("[VoiceTranscription] Recognition ended"),p&&s&&p(s.trim())}function v(n){a="";for(let e=n.resultIndex;e<n.results.length;e++){const t=n.results[e],r=t[0].transcript;t.isFinal?s+=r+" ":a+=r}l&&l({final:s.trim(),interim:a,combined:(s+a).trim()})}function m(n){switch(console.warn("[VoiceTranscription] Error:",n.error),n.error){case"no-speech":case"aborted":break;case"audio-capture":console.error("[VoiceTranscription] No microphone detected");break;case"not-allowed":console.error("[VoiceTranscription] Microphone permission denied");break;case"network":console.error("[VoiceTranscription] Network error");break;default:console.error("[VoiceTranscription] Unknown error:",n.error)}}function w(){console.log("[VoiceTranscription] No speech recognized")}function h(n){if(!n)return"";const e=document.createElement("div");return e.textContent=n,e.innerHTML}return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>u()):u(),{init:d,start:function(n={}){if(!o&&!d())return!1;if(c)return console.warn("[VoiceTranscription] Already recognizing"),!0;s="",a="",l=n.onUpdate||null,p=n.onFinal||null;try{return i.start(),!0}catch(n){if(console.error("[VoiceTranscription] Failed to start:",n),d())try{return i.start(),!0}catch(n){console.error("[VoiceTranscription] Retry failed:",n)}return!1}},stop:function(){if(!i||!c)return s.trim();try{i.stop()}catch(n){console.error("[VoiceTranscription] Failed to stop:",n)}return s.trim()},abort:function(){if(i){p=null;try{i.abort()}catch(n){console.error("[VoiceTranscription] Failed to abort:",n)}s="",a=""}},getTranscript:function(){return{final:s.trim(),interim:a,combined:(s+a).trim(),isRecognizing:c}},setLanguage:function(n){i&&(i.lang=n)},isSupported:function(){return o||u(),o},renderTranscriptDisplay:function(n,e){return n?`\n            <div class="voice-transcript" id="voice-transcript-${e}">\n                <button class="voice-transcript-toggle" onclick="CinqVoiceTranscription.toggleTranscript('${e}')" type="button" aria-expanded="false" aria-controls="voice-transcript-text-${e}">\n                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>\n                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>\n                    </svg>\n                    <span>Transcription</span>\n                    <svg class="voice-transcript-chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <polyline points="6 9 12 15 18 9"/>\n                    </svg>\n                </button>\n                <div class="voice-transcript-content" id="voice-transcript-text-${e}">\n                    <p>${h(n)}</p>\n                </div>\n            </div>\n        `:""},toggleTranscript:function(n){const e=document.getElementById(`voice-transcript-${n}`),t=document.getElementById(`voice-transcript-text-${n}`),r=e?.querySelector(".voice-transcript-toggle");if(!e||!t||!r)return;const i=e.classList.contains("expanded");e.classList.toggle("expanded",!i),r.setAttribute("aria-expanded",!i),"function"==typeof triggerHaptic&&triggerHaptic("tap")},createTranscriptPreview:function(n,e=!1){const t=document.createElement("div");return t.className="voice-transcript-preview"+(e?" interim":""),t.innerHTML=`\n            <span class="voice-transcript-icon">üìù</span>\n            <span class="voice-transcript-text">${h(n)||"<em>En √©coute...</em>"}</span>\n        `,t},get isRecognizing(){return c}}}();window.CinqVoiceTranscription=CinqVoiceTranscription;