"use strict";const CinqFormatting=function(){const t=["small","normal","large","huge"],e=["default","brand","red","orange","amber","green","teal","blue","indigo","purple","pink","rose"],n=["left","center","right"],o={size:"normal",color:"default",align:"left"};let a={...o},i=!1,r=!1,l=null,s=null,c=null,u=null,d=null;function g(){i=!i,l&&(l.style.display=i?"flex":"none"),c&&(c.classList.toggle("active",i),c.setAttribute("aria-expanded",i)),s&&s.classList.toggle("has-formatting",i),window.announce&&window.announce(i?"Barre de formatage ouverte":"Barre de formatage fermée")}function f(i){const r=i.target.closest("[data-action]");if(!r)return;switch(r.dataset.action){case"size":!function(e){if(!t.includes(e))return;if(a.size=e,x(),y(),v(),window.announce){const t={small:"petit",normal:"normal",large:"grand",huge:"très grand"};window.announce(`Taille de texte: ${t[e]}`)}}(r.dataset.size);break;case"color":!function(t){if(!e.includes(t))return;a.color=t,x(),y(),v(),m(),window.announce&&window.announce(`Couleur de texte: ${w(t)}`)}(r.dataset.color),b();break;case"align":!function(t){if(!n.includes(t))return;if(a.align=t,x(),y(),v(),window.announce){const e={left:"gauche",center:"centré",right:"droite"};window.announce(`Alignement: ${e[t]}`)}}(r.dataset.align);break;case"reset":a={...o},x(),y(),v(),m(),window.announce&&window.announce("Formatage réinitialisé")}}function p(t){t.stopPropagation(),r=!r,u=document.getElementById("color-palette");const e=document.getElementById("color-picker-btn");u&&u.classList.toggle("open",r),e&&e.setAttribute("aria-expanded",r)}function b(){r=!1,u=document.getElementById("color-palette");const t=document.getElementById("color-picker-btn");u&&u.classList.remove("open"),t&&t.setAttribute("aria-expanded","false")}function m(){const t=document.getElementById("color-picker-btn");if(!t)return;const e={default:"var(--color-text-primary)",brand:"var(--color-brand)",red:"#ef4444",orange:"#f97316",amber:"#f59e0b",green:"#22c55e",teal:"#14b8a6",blue:"#3b82f6",indigo:"#6366f1",purple:"#a855f7",pink:"#ec4899",rose:"#f43f5e"};t.style.background=e[a.color]||e.default}function x(){d&&(d.value=JSON.stringify(a))}function y(){l&&(l.querySelectorAll('[data-action="size"]').forEach(t=>{t.classList.toggle("active",t.dataset.size===a.size)}),l.querySelectorAll('[data-action="color"]').forEach(t=>{const e=t.dataset.color===a.color;t.classList.toggle("active",e),t.setAttribute("aria-selected",e)}),l.querySelectorAll('[data-action="align"]').forEach(t=>{t.classList.toggle("active",t.dataset.align===a.align)}))}function v(){s&&(t.forEach(t=>s.classList.remove(`text-${t}`)),e.forEach(t=>s.classList.remove(`color-${t}`)),n.forEach(t=>s.classList.remove(`align-${t}`)),s.classList.add(`text-${a.size}`),s.classList.add(`color-${a.color}`),s.classList.add(`align-${a.align}`))}function h(t){const e=l.querySelectorAll(".formatting-btn, .color-btn, .color-swatch"),n=Array.from(e).indexOf(document.activeElement);switch(t.key){case"ArrowRight":case"ArrowDown":t.preventDefault(),n<e.length-1?e[n+1].focus():e[0].focus();break;case"ArrowLeft":case"ArrowUp":t.preventDefault(),n>0?e[n-1].focus():e[e.length-1].focus();break;case"Escape":b()}}function w(t){return{default:"Par défaut",brand:"Cinq",red:"Rouge",orange:"Orange",amber:"Ambre",green:"Vert",teal:"Turquoise",blue:"Bleu",indigo:"Indigo",purple:"Violet",pink:"Rose",rose:"Rosé"}[t]||t}return{init:function(){s=document.getElementById("post-content"),s?(d=document.createElement("input"),d.type="hidden",d.id="post-format-data",d.name="format",d.value=JSON.stringify(o),s.parentNode.insertBefore(d,s),l=document.createElement("div"),l.className="formatting-toolbar",l.id="formatting-toolbar",l.setAttribute("role","toolbar"),l.setAttribute("aria-label","Options de formatage du texte"),l.style.display="none",l.innerHTML=`\n            \x3c!-- Size Group --\x3e\n            <div class="formatting-group" role="group" aria-label="Taille du texte">\n                <span class="formatting-label">Taille</span>\n                <button type="button" class="formatting-btn" data-size="small" data-action="size" title="Petit texte" aria-label="Petit texte">\n                    <span style="font-size:10px">A</span>\n                </button>\n                <button type="button" class="formatting-btn active" data-size="normal" data-action="size" title="Texte normal" aria-label="Texte normal">\n                    <span style="font-size:12px">A</span>\n                </button>\n                <button type="button" class="formatting-btn" data-size="large" data-action="size" title="Grand texte" aria-label="Grand texte">\n                    <span style="font-size:14px">A</span>\n                </button>\n                <button type="button" class="formatting-btn" data-size="huge" data-action="size" title="Très grand texte" aria-label="Très grand texte">\n                    <span style="font-size:16px;font-weight:700">A</span>\n                </button>\n            </div>\n            \n            \x3c!-- Color Group --\x3e\n            <div class="formatting-group" role="group" aria-label="Couleur du texte">\n                <span class="formatting-label">Couleur</span>\n                <div class="color-picker-dropdown">\n                    <button type="button" class="color-btn" id="color-picker-btn" title="Choisir une couleur" aria-label="Choisir une couleur" aria-haspopup="true" aria-expanded="false">\n                        <span class="formatting-sr-only">Couleur actuelle: par défaut</span>\n                    </button>\n                    <div class="color-palette" id="color-palette" role="listbox" aria-label="Palette de couleurs">\n                        ${e.map(t=>`\n                            <button type="button" class="color-swatch ${"default"===t?"active":""}" \n                                    data-color="${t}" \n                                    data-action="color" \n                                    role="option"\n                                    aria-selected="${"default"===t}"\n                                    title="${w(t)}"\n                                    aria-label="${w(t)}">\n                            </button>\n                        `).join("")}\n                    </div>\n                </div>\n            </div>\n            \n            \x3c!-- Alignment Group --\x3e\n            <div class="formatting-group" role="group" aria-label="Alignement du texte">\n                <span class="formatting-label">Align</span>\n                <button type="button" class="formatting-btn active" data-align="left" data-action="align" title="Aligner à gauche" aria-label="Aligner à gauche">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="15" y2="12"/><line x1="3" y1="18" x2="18" y2="18"/>\n                    </svg>\n                </button>\n                <button type="button" class="formatting-btn" data-align="center" data-action="align" title="Centrer" aria-label="Centrer">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <line x1="3" y1="6" x2="21" y2="6"/><line x1="6" y1="12" x2="18" y2="12"/><line x1="4" y1="18" x2="20" y2="18"/>\n                    </svg>\n                </button>\n                <button type="button" class="formatting-btn" data-align="right" data-action="align" title="Aligner à droite" aria-label="Aligner à droite">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <line x1="3" y1="6" x2="21" y2="6"/><line x1="9" y1="12" x2="21" y2="12"/><line x1="6" y1="18" x2="21" y2="18"/>\n                    </svg>\n                </button>\n            </div>\n            \n            \x3c!-- Reset Button --\x3e\n            <div class="formatting-group">\n                <button type="button" class="formatting-btn" data-action="reset" title="Réinitialiser le formatage" aria-label="Réinitialiser le formatage">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>\n                        <path d="M3 3v5h5"/>\n                    </svg>\n                </button>\n            </div>\n        `,s.parentNode.insertBefore(l,s),function(){const t=document.querySelector(".composer-actions");if(!t)return;c=document.createElement("button"),c.type="button",c.className="composer-btn formatting-toggle-btn",c.id="formatting-toggle",c.setAttribute("aria-label","Ouvrir les options de formatage"),c.setAttribute("aria-expanded","false"),c.setAttribute("aria-controls","formatting-toolbar"),c.innerHTML='\n            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                <path d="M4 7V4h16v3"/>\n                <path d="M9 20h6"/>\n                <path d="M12 4v16"/>\n            </svg>\n            <span>Format</span>\n        ';const e=t.querySelector(".composer-btn");e&&e.nextSibling?t.insertBefore(c,e.nextSibling):t.appendChild(c)}(),function(){c&&c.addEventListener("click",g);l&&l.addEventListener("click",f);const t=document.getElementById("color-picker-btn");t&&t.addEventListener("click",p);document.addEventListener("click",t=>{r&&!t.target.closest(".color-picker-dropdown")&&b()}),l&&l.addEventListener("keydown",h)}(),v(),console.log("[CinqFormatting] Initialized")):console.warn("[CinqFormatting] Composer textarea not found")},getFormat:function(){return{...a}},setFormat:function(o){o&&(o.size&&t.includes(o.size)&&(a.size=o.size),o.color&&e.includes(o.color)&&(a.color=o.color),o.align&&n.includes(o.align)&&(a.align=o.align),x(),y(),v(),m())},applyToPost:function(o,a){o&&a&&(t.forEach(t=>o.classList.remove(`text-${t}`)),e.forEach(t=>o.classList.remove(`color-${t}`)),n.forEach(t=>o.classList.remove(`align-${t}`)),a.size&&o.classList.add(`text-${a.size}`),a.color&&o.classList.add(`color-${a.color}`),a.align&&o.classList.add(`align-${a.align}`))},parseFormat:function(o){if(!o)return null;try{const a=JSON.parse(o);return{size:t.includes(a.size)?a.size:"normal",color:e.includes(a.color)?a.color:"default",align:n.includes(a.align)?a.align:"left"}}catch(t){return null}},reset:function(){a={...o},x(),y(),v(),m()},toggleToolbar:g,SIZES:t,COLORS:e,ALIGNMENTS:n,DEFAULT_FORMAT:o}}();"loading"===document.readyState?document.addEventListener("DOMContentLoaded",CinqFormatting.init):setTimeout(CinqFormatting.init,0),window.CinqFormatting=CinqFormatting;