<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Mot de passe oubli√© ‚Äî Cinq</title>
    
    <!-- SEO -->
    <meta name="description" content="R√©initialise ton mot de passe Cinq pour retrouver l'acc√®s √† ton anti-r√©seau social.">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Canonical -->
    <link rel="canonical" href="https://cinq.app/forgot-password">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Mot de passe oubli√© ‚Äî Cinq">
    <meta property="og:description" content="R√©initialise ton mot de passe pour retrouver tes 5.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://cinq.app/forgot-password">
    <meta property="og:site_name" content="Cinq">
    <meta property="og:locale" content="fr_FR">
    <meta property="og:image" content="https://cinq.app/og-image.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <meta name="theme-color" content="#0e0e12" id="theme-color-meta">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/icon-192x192.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap"></noscript>
    
    <!-- Design System -->
    <link rel="stylesheet" href="/design/styles.min.css">
    <link rel="stylesheet" href="/css/mobile-responsive.min.css">
    <link rel="stylesheet" href="/css/a11y.min.css">
    
    <!-- Theme CSS for smooth transitions -->
    <link rel="stylesheet" href="/css/theme.css">
    
    <!-- Theme initialization (before body to prevent flash) -->
    <script>
        (function(){var h=document.documentElement,s=localStorage.getItem('cinq_theme'),p=s||'dark',t=p;if(p==='auto'){t=window.matchMedia&&window.matchMedia('(prefers-color-scheme:light)').matches?'light':'dark'}h.setAttribute('data-theme',t);h.setAttribute('data-theme-preference',p);h.classList.add('theme-loading');var m=document.getElementById('theme-color-meta');if(m)m.content=t==='light'?'#faf9f7':'#0e0e12';var a=localStorage.getItem('cinq_accent')||'indigo';h.setAttribute('data-accent',a)})();
        
        const THEMES = ['dark', 'light', 'auto'];
        function getSystemPref() { return window.matchMedia && window.matchMedia('(prefers-color-scheme:light)').matches ? 'light' : 'dark'; }
        function getEffective(p) { return p === 'auto' ? getSystemPref() : (p || 'dark'); }
        function toggleTheme() {
            var h = document.documentElement;
            var curr = localStorage.getItem('cinq_theme') || 'dark';
            var next = THEMES[(THEMES.indexOf(curr) + 1) % 3];
            var eff = getEffective(next);
            h.classList.add('theme-transitioning');
            h.setAttribute('data-theme', eff);
            h.setAttribute('data-theme-preference', next);
            localStorage.setItem('cinq_theme', next);
            var m = document.getElementById('theme-color-meta');
            if(m) m.content = eff === 'light' ? '#faf9f7' : '#0e0e12';
            setTimeout(function() { h.classList.remove('theme-transitioning'); }, 400);
        }
        requestAnimationFrame(function() { requestAnimationFrame(function() { document.documentElement.classList.remove('theme-loading'); }); });
    </script>
    <style>
        /* ===== LAYOUT ===== */
        .forgot-container {
            min-height: 100vh;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--space-5);
            padding-bottom: calc(var(--space-5) + 60px);
        }
        
        @media (max-width: 380px) {
            .forgot-container {
                padding: var(--space-4);
                padding-bottom: calc(var(--space-4) + 70px);
            }
        }
        
        /* ===== CARD ===== */
        .forgot-card {
            background: var(--color-bg-secondary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            width: 100%;
            max-width: 400px;
            position: relative;
            box-shadow: var(--shadow-xl);
            animation: card-enter 0.4s var(--ease-out-expo);
        }
        
        @keyframes card-enter {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .forgot-card::before {
            content: '';
            position: absolute;
            inset: -1px;
            border-radius: inherit;
            background: var(--cinq-gradient);
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            padding: 1px;
        }
        
        .forgot-card:hover::before {
            opacity: 0.4;
        }
        
        .forgot-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: var(--space-6);
            right: var(--space-6);
            height: 1px;
            background: var(--glass-highlight);
            pointer-events: none;
        }
        
        /* ===== LOGO ===== */
        .forgot-logo {
            text-align: center;
            margin-bottom: var(--space-6);
        }
        
        .forgot-logo .five {
            font-family: var(--font-display);
            font-size: 4rem;
            font-weight: 700;
            background: var(--cinq-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 4px 12px var(--color-brand-glow));
            display: inline-block;
            transition: transform 0.3s var(--ease-spring);
        }
        
        .forgot-logo .five:hover {
            transform: scale(1.1) rotate(-5deg);
        }
        
        /* ===== TYPOGRAPHY ===== */
        .forgot-title {
            font-family: var(--font-display);
            font-size: var(--text-2xl);
            font-weight: 600;
            color: var(--color-text-primary);
            text-align: center;
            margin-bottom: var(--space-2);
        }
        
        .forgot-subtitle {
            font-size: var(--text-sm);
            color: var(--color-text-secondary);
            text-align: center;
            margin-bottom: var(--space-6);
            line-height: 1.5;
        }
        
        /* ===== FORM ===== */
        .form-group {
            margin-bottom: var(--space-4);
        }
        
        .form-label {
            display: block;
            font-size: var(--text-sm);
            font-weight: 500;
            color: var(--color-text-secondary);
            margin-bottom: var(--space-2);
        }
        
        .form-input {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            background: var(--color-bg-tertiary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            font-size: var(--text-base);
            color: var(--color-text-primary);
            transition: all 0.2s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--color-brand);
            box-shadow: 0 0 0 3px var(--color-brand-muted);
        }
        
        .form-input.error {
            border-color: var(--color-error);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }
        
        .field-error {
            font-size: var(--text-xs);
            color: var(--color-error);
            margin-top: var(--space-1);
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }
        
        /* ===== SUBMIT BUTTON ===== */
        .submit-btn {
            width: 100%;
            padding: var(--space-4);
            background: var(--cinq-gradient);
            border: none;
            border-radius: var(--radius-lg);
            font-family: var(--font-display);
            font-size: var(--text-base);
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--color-brand-glow);
        }
        
        .submit-btn:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .submit-btn.loading {
            pointer-events: none;
        }
        
        .submit-btn.loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            right: var(--space-4);
            top: 50%;
            transform: translateY(-50%);
        }
        
        @keyframes spin {
            to { transform: translateY(-50%) rotate(360deg); }
        }
        
        /* ===== MESSAGE ===== */
        .message {
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            margin-top: var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        
        .message.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }
        
        .message.success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.2);
            color: #86efac;
        }
        
        /* ===== SUCCESS STATE ===== */
        .success-state {
            text-align: center;
            padding: var(--space-4) 0;
        }
        
        .success-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-4);
            animation: success-pop 0.5s var(--ease-spring);
        }
        
        @keyframes success-pop {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .success-icon svg {
            color: #22c55e;
        }
        
        .success-title {
            font-family: var(--font-display);
            font-size: var(--text-xl);
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: var(--space-2);
        }
        
        .success-text {
            font-size: var(--text-sm);
            color: var(--color-text-secondary);
            line-height: 1.6;
        }
        
        /* ===== LINKS ===== */
        .back-link {
            text-align: center;
            margin-top: var(--space-5);
            font-size: var(--text-sm);
            color: var(--color-text-muted);
        }
        
        .back-link a {
            color: var(--color-brand);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .back-link a:hover {
            color: var(--color-brand-hover);
            text-decoration: underline;
        }
        
        /* ===== THEME TOGGLE ===== */
        .theme-toggle {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: var(--color-bg-tertiary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all var(--transition-fast);
            overflow: hidden;
        }
        
        .theme-toggle:hover {
            background: var(--color-bg-elevated);
            border-color: var(--color-border-active);
            transform: scale(1.05);
        }
        
        .theme-toggle-icon {
            position: absolute;
            transition: transform 0.4s var(--ease-spring), opacity 0.3s;
            color: var(--color-text-secondary);
        }
        
        .theme-toggle .icon-sun {
            transform: rotate(0) scale(1);
            opacity: 1;
        }
        
        .theme-toggle .icon-moon {
            transform: rotate(-90deg) scale(0);
            opacity: 0;
        }
        
        [data-theme="light"] .theme-toggle .icon-sun {
            transform: rotate(90deg) scale(0);
            opacity: 0;
        }
        
        [data-theme="light"] .theme-toggle .icon-moon {
            transform: rotate(0) scale(1);
            opacity: 1;
        }
        
        /* ===== PENTAGON PATTERN ===== */
        .pentagon-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpolygon fill='%23ff6b4a' points='50,5 95,35 80,90 20,90 5,35'/%3E%3C/svg%3E");
            background-size: 60px 60px;
        }
        
        /* ===== GRADIENT ORBS ===== */
        .gradient-orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            pointer-events: none;
            z-index: -1;
        }
        
        .gradient-orb-1 {
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255, 107, 74, 0.15), transparent 70%);
            top: -100px;
            right: -100px;
        }
        
        .gradient-orb-2 {
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(251, 191, 36, 0.1), transparent 70%);
            bottom: -50px;
            left: -50px;
        }
        
        /* ===== NOISE OVERLAY ===== */
        .noise-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            opacity: 0.015;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        }
    </style>
    <!-- View Transitions -->
    <link rel="stylesheet" href="/css/view-transitions.min.css">
</head>
<body>
    <!-- Skip Links - WCAG AAA Compliant -->
    <nav class="skip-links" aria-label="Liens d'√©vitement">
        <a href="#forgot-form" class="skip-link">Aller au formulaire</a>
        <a href="#main-content" class="skip-link">Aller au contenu principal</a>
    </nav>
    
    <!-- Live region for form validation -->
    <div id="sr-announce" class="sr-announce" aria-live="polite" aria-atomic="true"></div>
    <div id="form-errors" class="sr-announce" aria-live="assertive" aria-atomic="true"></div>
    
    <div class="noise-overlay" aria-hidden="true"></div>
    
    <!-- Theme Toggle -->
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Basculer mode clair/sombre" style="position: fixed; top: var(--space-4); right: var(--space-4); z-index: 100;">
        <svg class="icon-sun theme-toggle-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
        <svg class="icon-moon theme-toggle-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
    </button>
    
    <!-- Pentagon pattern -->
    <div class="pentagon-pattern" aria-hidden="true"></div>
    
    <!-- Ambient orbs -->
    <div class="gradient-orb gradient-orb-1" aria-hidden="true"></div>
    <div class="gradient-orb gradient-orb-2" aria-hidden="true"></div>

    <main id="main-content">
        <div class="forgot-container">
            <div class="forgot-card">
                <div class="forgot-logo">
                    <a href="/" aria-label="Retour √† l'accueil"><span class="five" aria-hidden="true">5</span></a>
                </div>
                
                <!-- Form State -->
                <div id="form-state">
                    <h1 class="forgot-title">Mot de passe oubli√© ?</h1>
                    <p class="forgot-subtitle">Entre ton email et on t'envoie un lien pour r√©initialiser ton mot de passe.</p>

                    <form id="forgot-form" aria-label="Formulaire de r√©initialisation" novalidate>
                        <div class="form-group">
                            <label class="form-label" for="email">Email</label>
                            <input 
                                type="email" 
                                id="email" 
                                name="email" 
                                class="form-input" 
                                required 
                                autocomplete="email" 
                                aria-required="true"
                                placeholder="ton@email.com"
                                aria-describedby="email-error"
                            >
                            <div id="email-error" class="field-error" style="display: none;" role="alert"></div>
                        </div>

                        <button type="submit" class="submit-btn" id="submit-btn">
                            Envoyer le lien
                        </button>

                        <div id="message" class="message" style="display: none;" role="alert" aria-live="polite"></div>
                    </form>
                </div>

                <!-- Success State -->
                <div id="success-state" class="success-state" style="display: none;">
                    <div class="success-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                    </div>
                    <h2 class="success-title">Email envoy√© ! üì¨</h2>
                    <p class="success-text">
                        Si un compte existe avec cette adresse, tu recevras un email avec les instructions pour r√©initialiser ton mot de passe.
                        <br><br>
                        Pense √† v√©rifier tes spams !
                    </p>
                </div>

                <div class="back-link">
                    <a href="/login.html">‚Üê Retour √† la connexion</a>
                </div>
            </div>
        </div>
    </main>

    <script>
        const API_URL = '/api';

        // Check if already logged in
        if (localStorage.getItem('cinq_session')) {
            window.location.href = '/app.html';
        }

        function showFieldError(fieldId, message) {
            const errorEl = document.getElementById(`${fieldId}-error`);
            const inputEl = document.getElementById(fieldId);
            if (errorEl && inputEl) {
                errorEl.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg> ${message}`;
                errorEl.style.display = 'flex';
                inputEl.classList.add('error');
                inputEl.setAttribute('aria-invalid', 'true');
            }
        }

        function hideFieldError(fieldId) {
            const errorEl = document.getElementById(`${fieldId}-error`);
            const inputEl = document.getElementById(fieldId);
            if (errorEl && inputEl) {
                errorEl.style.display = 'none';
                inputEl.classList.remove('error');
                inputEl.removeAttribute('aria-invalid');
            }
        }

        function showMessage(text, type) {
            const msg = document.getElementById('message');
            const icon = type === 'error' 
                ? '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>'
                : '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>';
            
            msg.innerHTML = `${icon}<span>${text}</span>`;
            msg.className = `message ${type}`;
            msg.style.display = 'flex';
        }

        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Real-time validation
        document.getElementById('email').addEventListener('blur', function() {
            if (this.value && !validateEmail(this.value)) {
                showFieldError('email', 'Adresse email invalide');
            } else {
                hideFieldError('email');
            }
        });

        document.getElementById('email').addEventListener('input', function() {
            hideFieldError('email');
            document.getElementById('message').style.display = 'none';
        });

        document.getElementById('forgot-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            hideFieldError('email');
            document.getElementById('message').style.display = 'none';

            const email = document.getElementById('email').value.trim();
            const btn = document.getElementById('submit-btn');

            // Validation
            if (!email) {
                showFieldError('email', 'L\'email est requis');
                return;
            }

            if (!validateEmail(email)) {
                showFieldError('email', 'Adresse email invalide');
                return;
            }

            // Loading state
            btn.disabled = true;
            btn.classList.add('loading');
            btn.textContent = 'Envoi en cours...';

            try {
                const response = await fetch(`${API_URL}/auth`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        action: 'forgot-password',
                        email 
                    })
                });

                // Always show success to prevent email enumeration
                document.getElementById('form-state').style.display = 'none';
                document.getElementById('success-state').style.display = 'block';

            } catch (error) {
                // Still show success to prevent email enumeration
                document.getElementById('form-state').style.display = 'none';
                document.getElementById('success-state').style.display = 'block';
            }
        });
    </script>
    <!-- View Transitions -->
    <script defer src="/js/view-transitions.min.js"></script>
</body>
</html>
