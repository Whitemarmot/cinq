<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Offrir Cinq ‚Äî L'anti-r√©seau social</title>
    
    <!-- SEO -->
    <meta name="description" content="Offre Cinq √† quelqu'un qui compte. L'anti-r√©seau social o√π tu choisis tes 5 proches. Un cadeau unique pour renforcer les liens qui comptent vraiment.">
    <meta name="keywords" content="cinq, cadeau, offrir, r√©seau social, anti-r√©seau, proches, amis, famille">
    <meta name="author" content="Cinq">
    <meta name="robots" content="index, follow">
    
    <!-- Canonical -->
    <link rel="canonical" href="https://cinq.app/gift">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Offrir Cinq ‚Äî L'anti-r√©seau social">
    <meta property="og:description" content="Offre Cinq √† quelqu'un qui compte. 5 proches, pas de likes, pas d'algorithme.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://cinq.app/gift.html">
    <meta property="og:image" content="https://cinq.app/og-image.png">
    <meta property="og:site_name" content="Cinq">
    <meta property="og:locale" content="fr_FR">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Offrir Cinq">
    <meta name="twitter:description" content="Offre Cinq √† quelqu'un qui compte vraiment.">
    <meta name="twitter:image" content="https://cinq.app/og-image.png">
    <meta name="twitter:site" content="@cinqapp">
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Product",
        "name": "Cinq - Carte Cadeau",
        "description": "Offre Cinq √† quelqu'un qui compte. L'anti-r√©seau social o√π tu choisis tes 5 proches.",
        "brand": {
            "@type": "Organization",
            "name": "Cinq",
            "url": "https://cinq.app"
        },
        "offers": {
            "@type": "Offer",
            "availability": "https://schema.org/InStock",
            "price": "0",
            "priceCurrency": "EUR",
            "url": "https://cinq.app/gift"
        },
        "image": "https://cinq.app/og-image.png"
    }
    </script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <meta name="theme-color" content="#0e0e12" id="theme-color-meta">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/icon-192x192.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap"></noscript>
    
    <!-- Design System -->
    <link rel="stylesheet" href="/design/styles.min.css">
    <link rel="stylesheet" href="/css/a11y.min.css">
    <link rel="stylesheet" href="/css/mobile-responsive.min.css">
    
    <!-- Theme CSS for smooth transitions -->
    <link rel="stylesheet" href="/css/theme.min.css">
    
    <!-- Theme initialization -->
    <script>
        (function(){var h=document.documentElement,s=localStorage.getItem('cinq_theme'),p=s||'dark',t=p;if(p==='auto'){t=window.matchMedia&&window.matchMedia('(prefers-color-scheme:light)').matches?'light':'dark'}h.setAttribute('data-theme',t);h.setAttribute('data-theme-preference',p);h.classList.add('theme-loading');var m=document.getElementById('theme-color-meta');if(m)m.content=t==='light'?'#faf9f7':'#0e0e12';var a=localStorage.getItem('cinq_accent')||'indigo';h.setAttribute('data-accent',a)})();
        var THEMES=['dark','light','auto'];
        function getSystemPref(){return window.matchMedia&&window.matchMedia('(prefers-color-scheme:light)').matches?'light':'dark'}
        function getEffective(p){return p==='auto'?getSystemPref():(p||'dark')}
        function toggleTheme(){var h=document.documentElement,c=localStorage.getItem('cinq_theme')||'dark',n=THEMES[(THEMES.indexOf(c)+1)%3],e=getEffective(n);h.classList.add('theme-transitioning');h.setAttribute('data-theme',e);h.setAttribute('data-theme-preference',n);localStorage.setItem('cinq_theme',n);var m=document.getElementById('theme-color-meta');if(m)m.content=e==='light'?'#faf9f7':'#0e0e12';setTimeout(function(){h.classList.remove('theme-transitioning')},400)}
        requestAnimationFrame(function(){requestAnimationFrame(function(){document.documentElement.classList.remove('theme-loading')})});
    </script>
    <style>
        /* ===== LAYOUT ===== */
        .gift-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--space-5);
            text-align: center;
        }
        
        @media (max-width: 380px) {
            .gift-container {
                padding: var(--space-4);
            }
        }
        
        /* ===== CARD ===== */
        .gift-card {
            background: var(--color-bg-secondary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            width: 100%;
            max-width: 420px;
            position: relative;
            box-shadow: var(--shadow-xl);
            animation: card-enter 0.4s var(--ease-out-expo);
        }
        
        @keyframes card-enter {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .gift-card::before {
            content: '';
            position: absolute;
            inset: -1px;
            border-radius: inherit;
            background: var(--cinq-gradient);
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            padding: 1px;
        }
        
        .gift-card:hover::before {
            opacity: 0.4;
        }
        
        .gift-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: var(--space-6);
            right: var(--space-6);
            height: 1px;
            background: var(--glass-highlight);
            pointer-events: none;
        }
        
        /* ===== LOGO ===== */
        .gift-logo { 
            font-family: var(--font-display);
            font-size: 4.5rem;
            font-weight: 700;
            margin-bottom: var(--space-5);
            background: var(--cinq-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 4px 12px var(--color-brand-glow));
            position: relative;
            display: inline-block;
            transition: transform 0.3s var(--ease-spring);
        }
        
        .gift-logo:hover {
            transform: scale(1.05) rotate(-3deg);
        }
        
        .gift-logo::before {
            content: '';
            position: absolute;
            inset: -25px;
            background: conic-gradient(
                from 0deg,
                rgba(255, 107, 74, 0.3) 0deg,
                rgba(255, 138, 106, 0.2) 72deg,
                rgba(251, 191, 36, 0.15) 144deg,
                rgba(167, 139, 250, 0.2) 216deg,
                rgba(255, 107, 74, 0.3) 288deg
            );
            clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
            opacity: 0.4;
            z-index: -1;
            filter: blur(18px);
            animation: pentagon-pulse 4s ease-in-out infinite;
        }
        
        @keyframes pentagon-pulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.05); }
        }
        
        /* ===== TITLES ===== */
        .gift-title { 
            font-family: var(--font-display);
            font-size: var(--text-2xl); 
            font-weight: 600; 
            margin-bottom: var(--space-2);
            letter-spacing: -0.02em;
        }
        
        .gift-subtitle { 
            color: var(--color-text-muted); 
            margin-bottom: var(--space-6);
            font-size: var(--text-sm);
        }
        
        /* ===== GENERATE BUTTON ===== */
        .generate-btn {
            width: 100%;
            padding: var(--space-4);
            background: var(--cinq-gradient);
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            font-family: var(--font-display);
            font-size: var(--text-base);
            font-weight: 600;
            cursor: pointer;
            transition: 
                transform 0.15s var(--ease-spring),
                box-shadow 0.2s,
                opacity 0.15s;
            box-shadow: var(--shadow-glow-sm);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
        }
        
        .generate-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .generate-btn:hover:not(:disabled)::before { 
            left: 100%; 
        }
        
        .generate-btn:hover:not(:disabled) { 
            transform: translateY(-2px) scale(1.01);
            box-shadow: var(--shadow-glow);
        }
        
        .generate-btn:active:not(:disabled) {
            transform: translateY(0) scale(0.98);
        }
        
        .generate-btn:disabled { 
            opacity: 0.5; 
            cursor: not-allowed; 
            transform: none !important; 
        }
        
        /* Loading state */
        .generate-btn .loading-spinner {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ===== RESULT ===== */
        .result { 
            margin-top: var(--space-6); 
            display: none;
            animation: result-enter 0.4s var(--ease-out-expo);
        }
        
        @keyframes result-enter {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result.show { 
            display: block; 
        }
        
        .code-box {
            background: var(--color-bg-elevated);
            border: 2px dashed var(--color-brand);
            border-radius: var(--radius-xl);
            padding: var(--space-5);
            margin: var(--space-4) 0;
            position: relative;
            overflow: hidden;
        }
        
        .code-box::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--cinq-gradient);
            opacity: 0.05;
        }
        
        .code-label {
            font-size: var(--text-xs);
            color: var(--color-text-muted);
            margin-bottom: var(--space-2);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .code {
            font-size: var(--text-xl);
            font-weight: 700;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            color: var(--color-brand);
            letter-spacing: 0.1em;
            word-break: break-all;
            position: relative;
        }
        
        .share-section {
            margin-top: var(--space-4);
            padding-top: var(--space-4);
            border-top: 1px solid var(--color-border);
        }
        
        .share-label {
            font-size: var(--text-xs);
            color: var(--color-text-muted);
            margin-bottom: var(--space-2);
        }
        
        .share-link {
            font-size: var(--text-sm);
            color: var(--color-text-secondary);
            word-break: break-all;
            padding: var(--space-3);
            background: var(--color-bg-tertiary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-border);
        }
        
        /* ===== ACTION BUTTONS ===== */
        .action-buttons {
            display: flex;
            gap: var(--space-3);
            margin-top: var(--space-4);
        }
        
        .copy-btn, .share-btn {
            flex: 1;
            padding: var(--space-3) var(--space-4);
            background: var(--color-bg-tertiary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            color: var(--color-text-primary);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s var(--ease-spring);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
        }
        
        .copy-btn:hover, .share-btn:hover {
            background: var(--color-bg-elevated);
            border-color: var(--color-border-active);
            transform: translateY(-1px);
        }
        
        .copy-btn:active, .share-btn:active {
            transform: translateY(0) scale(0.98);
        }
        
        .copy-btn.copied {
            background: var(--color-success-muted);
            border-color: var(--color-success);
            color: var(--color-success);
        }
        
        .share-btn {
            background: var(--cinq-gradient);
            border-color: transparent;
            color: white;
        }
        
        .share-btn:hover {
            box-shadow: var(--shadow-glow-sm);
        }
        
        /* ===== ERROR ===== */
        .error-message { 
            color: var(--color-error); 
            margin-top: var(--space-4);
            padding: var(--space-3) var(--space-4);
            background: var(--color-error-muted);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: var(--radius-lg);
            font-size: var(--text-sm);
            display: flex;
            align-items: center;
            gap: var(--space-2);
            animation: error-enter 0.3s var(--ease-out-expo);
        }
        
        @keyframes error-enter {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .error-message.hidden {
            display: none;
        }
        
        /* ===== LINKS ===== */
        .back-link {
            margin-top: var(--space-6);
            font-size: var(--text-sm);
            color: var(--color-text-muted);
        }
        
        .back-link a {
            color: var(--color-brand);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .back-link a:hover {
            color: var(--color-brand-hover);
            text-decoration: underline;
        }
        
        /* ===== THEME TOGGLE ===== */
        .theme-toggle {
            position: fixed;
            top: var(--space-4);
            right: var(--space-4);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: var(--color-bg-tertiary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
        }
        
        .theme-toggle:hover {
            background: var(--color-bg-elevated);
            transform: scale(1.05);
        }
        
        .theme-toggle .icon-sun,
        .theme-toggle .icon-moon {
            position: absolute;
            transition: all 0.3s var(--ease-spring);
            color: var(--color-text-secondary);
        }
        
        .theme-toggle .icon-sun { opacity: 1; transform: rotate(0) scale(1); }
        .theme-toggle .icon-moon { opacity: 0; transform: rotate(-90deg) scale(0.5); }
        
        [data-theme="light"] .theme-toggle .icon-sun { opacity: 0; transform: rotate(90deg) scale(0.5); }
        [data-theme="light"] .theme-toggle .icon-moon { opacity: 1; transform: rotate(0) scale(1); }
        
        /* ===== BACKGROUND ===== */
        .pentagon-pattern {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: -2;
            opacity: 0.02;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpolygon points='30,5 55,22 47,52 13,52 5,22' fill='none' stroke='%23ff6b4a' stroke-width='0.5'/%3E%3C/svg%3E");
            background-size: 60px 60px;
        }
        
        .gradient-orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.15;
            pointer-events: none;
            z-index: -1;
        }
        
        .gradient-orb-1 {
            width: 400px;
            height: 400px;
            background: var(--color-brand);
            top: -100px;
            right: -100px;
        }
        
        .gradient-orb-2 {
            width: 300px;
            height: 300px;
            background: #a78bfa;
            bottom: -50px;
            left: -50px;
        }
        
        /* ===== FOOTER ===== */
        .auth-footer {
            padding: var(--space-5);
            padding-bottom: max(var(--space-5), calc(env(safe-area-inset-bottom, 0px) + var(--space-4)));
            text-align: center;
            font-size: var(--text-xs);
            color: var(--color-text-muted);
            margin-top: auto;
        }
        
        .auth-footer nav {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-2);
        }
        
        .auth-footer a {
            color: var(--color-text-muted);
            padding: var(--space-2) var(--space-3);
            min-height: 44px;
            display: inline-flex;
            align-items: center;
            border-radius: var(--radius-md);
            transition: color 0.2s, background 0.2s;
        }
        
        .auth-footer a:hover {
            color: var(--color-text-secondary);
            background: var(--color-bg-tertiary);
        }
        
        /* ===== SUCCESS ANIMATION ===== */
        @keyframes success-pop {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .success-icon {
            animation: success-pop 0.4s var(--ease-spring);
        }
        
        /* ===== REDUCED MOTION ===== */
        @media (prefers-reduced-motion: reduce) {
            .gift-card,
            .result,
            .error-message,
            .gift-logo::before,
            .success-icon {
                animation: none !important;
            }
            
            .generate-btn::before {
                display: none;
            }
        }
    </style>
</head>
<body style="display: flex; flex-direction: column; min-height: 100vh; min-height: 100dvh;">
    <!-- Skip Links - WCAG AAA Compliant -->
    <nav class="skip-links" aria-label="Liens d'√©vitement">
        <a href="#main-content" class="skip-link">Aller au contenu principal</a>
        <a href="#gift-form" class="skip-link">Aller au formulaire de cadeau</a>
    </nav>
    
    <!-- Live region for dynamic announcements -->
    <div id="sr-announce" class="sr-announce" aria-live="polite" aria-atomic="true"></div>
    
    <div class="noise-overlay" aria-hidden="true"></div>
    
    <!-- Theme Toggle -->
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Basculer mode clair/sombre">
        <svg class="icon-sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
        <svg class="icon-moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
    </button>
    
    <div class="pentagon-pattern" aria-hidden="true"></div>
    <div class="gradient-orb gradient-orb-1" aria-hidden="true"></div>
    <div class="gradient-orb gradient-orb-2" aria-hidden="true"></div>
    
    <main id="main-content" style="flex: 1; display: flex;">
        <div class="gift-container">
            <div class="gift-card">
                <div class="gift-logo" aria-hidden="true">5</div>
                <h1 class="gift-title">Offrir Cinq</h1>
                <p class="gift-subtitle">G√©n√®re un code pour inviter quelqu'un dans ton cercle</p>
                
                <button class="generate-btn" id="generate-btn" onclick="generateGift()" aria-label="G√©n√©rer un nouveau code cadeau d'invitation">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <rect x="3" y="8" width="18" height="13" rx="2"/><path d="M12 8v13"/><path d="M3 12h18"/><path d="M12 8c-2.5-3-6-2-6 0s3.5 2 6 0"/><path d="M12 8c2.5-3 6-2 6 0s-3.5 2-6 0"/>
                    </svg>
                    <span id="btn-text">G√©n√©rer un code cadeau</span>
                </button>
                
                <div class="error-message hidden" id="error" role="alert" aria-live="polite">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                    <span id="error-text"></span>
                </div>
                
                <div class="result" id="result" role="region" aria-label="Code cadeau g√©n√©r√©">
                    <div class="code-box">
                        <p class="code-label">Code cadeau</p>
                        <p class="code" id="gift-code" aria-label="Code cadeau"></p>
                    </div>
                    
                    <div class="share-section">
                        <p class="share-label">Lien de partage</p>
                        <p class="share-link" id="share-link" aria-label="Lien de partage"></p>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="copy-btn" id="copy-btn" onclick="copyLink()" aria-label="Copier le lien de partage">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" id="copy-icon">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                            </svg>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" id="check-icon" style="display: none;">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                            <span id="copy-text">Copier le lien</span>
                        </button>
                        
                        <button class="share-btn" id="share-native-btn" onclick="shareNative()" aria-label="Partager via le syst√®me" style="display: none;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                            </svg>
                            <span>Partager</span>
                        </button>
                    </div>
                </div>
                
                <p class="back-link">
                    <a href="/" aria-label="Retour √† la page d'accueil">‚Üê Retour √† l'accueil</a>
                </p>
            </div>
        </div>
    </main>

    <script>
        let shareUrl = '';
        let generatedCode = '';
        
        // Check if Web Share API is available
        if (navigator.share) {
            document.getElementById('share-native-btn').style.display = 'flex';
        }
        
        async function generateGift() {
            const btn = document.getElementById('generate-btn');
            const btnText = document.getElementById('btn-text');
            const error = document.getElementById('error');
            const errorText = document.getElementById('error-text');
            const result = document.getElementById('result');
            
            btn.disabled = true;
            btnText.innerHTML = '<span class="loading-spinner"></span>G√©n√©ration...';
            error.classList.add('hidden');
            
            try {
                const res = await fetch('/api/gift?action=create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                const data = await res.json();
                
                if (!res.ok) {
                    throw new Error(data.error || 'Erreur lors de la g√©n√©ration');
                }
                
                if (data.code) {
                    generatedCode = data.code;
                    document.getElementById('gift-code').textContent = data.code;
                    shareUrl = data.gift?.shareUrl || `${window.location.origin}/register.html?code=${data.code}`;
                    document.getElementById('share-link').textContent = shareUrl;
                    result.classList.add('show');
                    
                    // Reset copy button
                    resetCopyButton();
                    
                    // Update button text
                    btnText.innerHTML = `
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <rect x="3" y="8" width="18" height="13" rx="2"/><path d="M12 8v13"/><path d="M3 12h18"/><path d="M12 8c-2.5-3-6-2-6 0s3.5 2 6 0"/><path d="M12 8c2.5-3 6-2 6 0s-3.5 2-6 0"/>
                        </svg>
                        G√©n√©rer un autre code
                    `;
                } else {
                    throw new Error(data.error || 'R√©ponse invalide du serveur');
                }
            } catch (e) {
                errorText.textContent = e.message;
                error.classList.remove('hidden');
                
                btnText.innerHTML = `
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <rect x="3" y="8" width="18" height="13" rx="2"/><path d="M12 8v13"/><path d="M3 12h18"/><path d="M12 8c-2.5-3-6-2-6 0s3.5 2 6 0"/><path d="M12 8c2.5-3 6-2 6 0s-3.5 2-6 0"/>
                    </svg>
                    R√©essayer
                `;
            }
            
            btn.disabled = false;
        }
        
        function resetCopyButton() {
            const btn = document.getElementById('copy-btn');
            const copyIcon = document.getElementById('copy-icon');
            const checkIcon = document.getElementById('check-icon');
            const copyText = document.getElementById('copy-text');
            
            btn.classList.remove('copied');
            copyIcon.style.display = 'block';
            checkIcon.style.display = 'none';
            copyText.textContent = 'Copier le lien';
        }
        
        async function copyLink() {
            const btn = document.getElementById('copy-btn');
            const copyIcon = document.getElementById('copy-icon');
            const checkIcon = document.getElementById('check-icon');
            const copyText = document.getElementById('copy-text');
            
            try {
                await navigator.clipboard.writeText(shareUrl);
                
                // Success state
                btn.classList.add('copied');
                copyIcon.style.display = 'none';
                checkIcon.style.display = 'block';
                copyText.textContent = 'Copi√© !';
                
                // Reset after 2 seconds
                setTimeout(resetCopyButton, 2000);
            } catch (err) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = shareUrl;
                textArea.style.position = 'fixed';
                textArea.style.left = '-9999px';
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                btn.classList.add('copied');
                copyIcon.style.display = 'none';
                checkIcon.style.display = 'block';
                copyText.textContent = 'Copi√© !';
                
                setTimeout(resetCopyButton, 2000);
            }
        }
        
        async function shareNative() {
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Rejoins-moi sur Cinq',
                        text: `Tu as re√ßu une invitation pour Cinq, l'anti-r√©seau social ! Code: ${generatedCode}`,
                        url: shareUrl
                    });
                } catch (err) {
                    // User cancelled or error
                    if (err.name !== 'AbortError') {
                        console.error('Share failed:', err);
                    }
                }
            }
        }
    </script>

    <!-- Footer -->
    <footer class="auth-footer" role="contentinfo">
        <nav aria-label="Liens l√©gaux">
            <a href="/privacy.html">Confidentialit√©</a>
            <span aria-hidden="true" style="opacity: 0.3;">¬∑</span>
            <a href="/terms.html">CGU</a>
            <span aria-hidden="true" style="opacity: 0.3;">¬∑</span>
            <span style="padding: 0 var(--space-2);">¬© 2025 Cinq</span>
        </nav>
    </footer>
    <!-- Easter Eggs ü•ö -->
    <script src="/js/easter-eggs.min.js" defer></script>
</body>
</html>
