"use strict";const CinqQuickShare=function(){const e=["image/jpeg","image/png","image/gif","image/webp"];let n=!1,t=null;function o(e,n){"function"==typeof showToast?showToast({type:e,message:n}):"function"==typeof window.Cinq?.showToast?window.Cinq.showToast({type:e,message:n}):console.log(`[QuickShare] ${e}: ${n}`)}function i(n){return n?e.includes(n.type)?n.size>5242880?{valid:!1,error:"Image trop grande (max 5 Mo)"}:{valid:!0}:{valid:!1,error:"Format non support√© (JPEG, PNG, GIF, WebP)"}:{valid:!1,error:"Aucun fichier"}}function r(e){return new Promise((n,t)=>{const o=new FileReader;o.onload=e=>n(e.target.result),o.onerror=e=>t(new Error("Erreur de lecture du fichier")),o.readAsDataURL(e)})}async function a(e,n={}){const a=function(e){const n=e.clipboardData?.items;if(!n)return null;for(const e of n)if(e.type.startsWith("image/"))return e.getAsFile();return null}(e);if(!a)return;const s=i(a);if(!s.valid)return o("error",s.error),void e.preventDefault();e.preventDefault();try{const e=await r(a);o("success","üìã Image coll√©e !"),n.onImage&&n.onImage({base64:e,file:a,type:a.type}),t&&t({base64:e,file:a,type:a.type})}catch(e){console.error("[QuickShare] Error processing pasted image:",e),o("error","Erreur lors du traitement de l'image")}}function s(e,n){const t="string"==typeof e?document.querySelector(e):e;if(!t)return console.warn("[QuickShare] Element not found:",e),()=>{};const o=e=>a(e,{onImage:n});return t.addEventListener("paste",o),()=>t.removeEventListener("paste",o)}function c(){const e=document.getElementById("chat-input"),n=document.getElementById("chat-input-area");e?(s(e,async({base64:e,file:n,type:t})=>{!function(e,n){const t=document.getElementById("chat-input-area"),o=document.getElementById("send-btn"),i=document.getElementById("file-preview-icon"),r=document.getElementById("file-preview-name"),a=document.getElementById("file-preview-meta");if(!t)return;window.pendingFileAttachment={file:e,name:e.name||"image.png",size:e.size,type:n||e.type,ext:(n||e.type).split("/")[1]||"png",isImage:!0},i&&(i.textContent="üñºÔ∏è");r&&(r.textContent="Image coll√©e");a&&(a.textContent=`${(e.size/1024).toFixed(1)} Ko`);t.classList.add("file-mode"),t.classList.remove("voice-mode"),o&&(o.disabled=!1);"function"==typeof triggerHaptic&&triggerHaptic("tap")}(n||function(e,n){const t=e.split(","),o=t[0].match(/:(.*?);/)?.[1]||"image/png",i=atob(t[1]);let r=i.length;const a=new Uint8Array(r);for(;r--;)a[r]=i.charCodeAt(r);return new File([a],n,{type:o})}(e,`image_${Date.now()}.${t.split("/")[1]||"png"}`),t)}),n&&l(n,!0),console.log("[QuickShare] Chat input initialized")):console.log("[QuickShare] Chat input not found, skipping")}function l(e,n=!1){if(!e)return;if(e.querySelector(".quick-share-hint"))return;const t=navigator.platform?.toLowerCase().includes("mac")||navigator.userAgent?.toLowerCase().includes("mac")?"‚åò":"Ctrl",o=document.createElement("div");o.className="quick-share-hint",o.setAttribute("aria-hidden","true"),o.innerHTML=`\n            <span class="quick-share-icon">üìã</span>\n            <kbd>${t}</kbd>+<kbd>V</kbd> ${n?"envoyer une image":"coller une image"}\n        `,o.style.cssText="\n            font-size: 0.7rem;\n            color: var(--color-text-muted, #888);\n            opacity: 0;\n            transition: opacity 0.2s;\n            padding: 0.25rem 0.5rem;\n            display: flex;\n            align-items: center;\n            gap: 0.35rem;\n            pointer-events: none;\n        ";const i=document.createElement("style");if(i.textContent="\n            .quick-share-hint kbd {\n                background: var(--color-bg-secondary, #222);\n                border: 1px solid var(--color-border, #333);\n                border-radius: 4px;\n                padding: 0.1rem 0.35rem;\n                font-family: inherit;\n                font-size: 0.65rem;\n                font-weight: 500;\n            }\n            .quick-share-hint .quick-share-icon {\n                font-size: 0.8rem;\n            }\n            .composer:focus-within .quick-share-hint,\n            .chat-input-area:focus-within .quick-share-hint {\n                opacity: 0.7;\n            }\n            .chat-input-area .quick-share-hint {\n                position: absolute;\n                bottom: 100%;\n                left: 50%;\n                transform: translateX(-50%);\n                margin-bottom: 0.25rem;\n                white-space: nowrap;\n                background: var(--color-bg-primary, #1a1a1a);\n                border-radius: 0.5rem;\n                z-index: 10;\n            }\n        ",document.getElementById("quick-share-styles")||(i.id="quick-share-styles",document.head.appendChild(i)),n)e.style.position="relative",e.appendChild(o);else{const n=e.querySelector(".composer-footer, .composer-actions");n?n.insertAdjacentElement("beforebegin",o):e.appendChild(o)}}function d(){n?console.log("[QuickShare] Already initialized"):(!function(){const e=document.getElementById("post-content");e?(s(e,async({base64:e,type:n})=>{"function"==typeof showImagePreview&&showImagePreview(e),"function"==typeof uploadImage&&await uploadImage(e,n)}),l(e.closest(".composer")),console.log("[QuickShare] Feed composer initialized")):console.log("[QuickShare] Feed composer not found, skipping")}(),c(),new MutationObserver(e=>{for(const n of e)for(const e of n.addedNodes)if(e.nodeType===Node.ELEMENT_NODE){const n=e.querySelectorAll?.(".reply-composer-input");n?.forEach(e=>{s(e,async({base64:e,type:n})=>{console.log("[QuickShare] Image pasted in reply composer")})})}}).observe(document.body,{childList:!0,subtree:!0}),console.log("[QuickShare] Reply composer observer initialized"),n=!0,console.log("[QuickShare] ‚úÖ Module initialized"))}return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):setTimeout(d,0),{init:d,bindTo:s,bindGlobal:function(e){const n=n=>{const t=n.target;("INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable)&&a(n,{onImage:e})};return document.addEventListener("paste",n),()=>document.removeEventListener("paste",n)},handlePaste:a,setCallback:function(e){t=e},validateImage:i,fileToBase64:r}}();"undefined"!=typeof module&&module.exports&&(module.exports=CinqQuickShare),window.CinqQuickShare=CinqQuickShare;