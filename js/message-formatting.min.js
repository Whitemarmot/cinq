"use strict";const CinqFormatting=(function(){const d=["small","normal","large","huge"],s=["default","brand","red","orange","amber","green","teal","blue","indigo","purple","pink","rose"],g=["left","center","right"],y={size:"normal",color:"default",align:"left"};let a={...y},c=!1,f=!1,n=null,o=null,i=null,p=null,l=null;function k(){if(o=document.getElementById("post-content"),!o){console.warn("[CinqFormatting] Composer textarea not found");return}A(),L(),z(),B(),u(),console.log("[CinqFormatting] Initialized")}function A(){l=document.createElement("input"),l.type="hidden",l.id="post-format-data",l.name="format",l.value=JSON.stringify(y),o.parentNode.insertBefore(l,o)}function L(){n=document.createElement("div"),n.className="formatting-toolbar",n.id="formatting-toolbar",n.setAttribute("role","toolbar"),n.setAttribute("aria-label","Options de formatage du texte"),n.style.display="none",n.innerHTML=`
            <!-- Size Group -->
            <div class="formatting-group" role="group" aria-label="Taille du texte">
                <span class="formatting-label">Taille</span>
                <button type="button" class="formatting-btn" data-size="small" data-action="size" title="Petit texte" aria-label="Petit texte">
                    <span style="font-size:10px">A</span>
                </button>
                <button type="button" class="formatting-btn active" data-size="normal" data-action="size" title="Texte normal" aria-label="Texte normal">
                    <span style="font-size:12px">A</span>
                </button>
                <button type="button" class="formatting-btn" data-size="large" data-action="size" title="Grand texte" aria-label="Grand texte">
                    <span style="font-size:14px">A</span>
                </button>
                <button type="button" class="formatting-btn" data-size="huge" data-action="size" title="Tr\xE8s grand texte" aria-label="Tr\xE8s grand texte">
                    <span style="font-size:16px;font-weight:700">A</span>
                </button>
            </div>
            
            <!-- Color Group -->
            <div class="formatting-group" role="group" aria-label="Couleur du texte">
                <span class="formatting-label">Couleur</span>
                <div class="color-picker-dropdown">
                    <button type="button" class="color-btn" id="color-picker-btn" title="Choisir une couleur" aria-label="Choisir une couleur" aria-haspopup="true" aria-expanded="false">
                        <span class="formatting-sr-only">Couleur actuelle: par d\xE9faut</span>
                    </button>
                    <div class="color-palette" id="color-palette" role="listbox" aria-label="Palette de couleurs">
                        ${s.map(e=>`
                            <button type="button" class="color-swatch ${e==="default"?"active":""}" 
                                    data-color="${e}" 
                                    data-action="color" 
                                    role="option"
                                    aria-selected="${e==="default"}"
                                    title="${h(e)}"
                                    aria-label="${h(e)}">
                            </button>
                        `).join("")}
                    </div>
                </div>
            </div>
            
            <!-- Alignment Group -->
            <div class="formatting-group" role="group" aria-label="Alignement du texte">
                <span class="formatting-label">Align</span>
                <button type="button" class="formatting-btn active" data-align="left" data-action="align" title="Aligner \xE0 gauche" aria-label="Aligner \xE0 gauche">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="15" y2="12"/><line x1="3" y1="18" x2="18" y2="18"/>
                    </svg>
                </button>
                <button type="button" class="formatting-btn" data-align="center" data-action="align" title="Centrer" aria-label="Centrer">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="6" x2="21" y2="6"/><line x1="6" y1="12" x2="18" y2="12"/><line x1="4" y1="18" x2="20" y2="18"/>
                    </svg>
                </button>
                <button type="button" class="formatting-btn" data-align="right" data-action="align" title="Aligner \xE0 droite" aria-label="Aligner \xE0 droite">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="6" x2="21" y2="6"/><line x1="9" y1="12" x2="21" y2="12"/><line x1="6" y1="18" x2="21" y2="18"/>
                    </svg>
                </button>
            </div>
            
            <!-- Reset Button -->
            <div class="formatting-group">
                <button type="button" class="formatting-btn" data-action="reset" title="R\xE9initialiser le formatage" aria-label="R\xE9initialiser le formatage">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                        <path d="M3 3v5h5"/>
                    </svg>
                </button>
            </div>
        `,o.parentNode.insertBefore(n,o)}function z(){const e=document.querySelector(".composer-actions");if(!e)return;i=document.createElement("button"),i.type="button",i.className="composer-btn formatting-toggle-btn",i.id="formatting-toggle",i.setAttribute("aria-label","Ouvrir les options de formatage"),i.setAttribute("aria-expanded","false"),i.setAttribute("aria-controls","formatting-toolbar"),i.innerHTML=`
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 7V4h16v3"/>
                <path d="M9 20h6"/>
                <path d="M12 4v16"/>
            </svg>
            <span>Format</span>
        `;const t=e.querySelector(".composer-btn");t&&t.nextSibling?e.insertBefore(i,t.nextSibling):e.appendChild(i)}function B(){i&&i.addEventListener("click",w),n&&n.addEventListener("click",E);const e=document.getElementById("color-picker-btn");e&&e.addEventListener("click",F),document.addEventListener("click",t=>{f&&!t.target.closest(".color-picker-dropdown")&&x()}),n&&n.addEventListener("keydown",I)}function w(){c=!c,n&&(n.style.display=c?"flex":"none"),i&&(i.classList.toggle("active",c),i.setAttribute("aria-expanded",c)),o&&o.classList.toggle("has-formatting",c),window.announce&&window.announce(c?"Barre de formatage ouverte":"Barre de formatage ferm\xE9e")}function E(e){const t=e.target.closest("[data-action]");if(!t)return;switch(t.dataset.action){case"size":C(t.dataset.size);break;case"color":T(t.dataset.color),x();break;case"align":$(t.dataset.align);break;case"reset":S();break}}function C(e){if(d.includes(e)&&(a.size=e,b(),m(),u(),window.announce)){const t={small:"petit",normal:"normal",large:"grand",huge:"tr\xE8s grand"};window.announce(`Taille de texte: ${t[e]}`)}}function T(e){s.includes(e)&&(a.color=e,b(),m(),u(),v(),window.announce&&window.announce(`Couleur de texte: ${h(e)}`))}function $(e){if(g.includes(e)&&(a.align=e,b(),m(),u(),window.announce)){const t={left:"gauche",center:"centr\xE9",right:"droite"};window.announce(`Alignement: ${t[e]}`)}}function S(){a={...y},b(),m(),u(),v(),window.announce&&window.announce("Formatage r\xE9initialis\xE9")}function F(e){e.stopPropagation(),f=!f,p=document.getElementById("color-palette");const t=document.getElementById("color-picker-btn");p&&p.classList.toggle("open",f),t&&t.setAttribute("aria-expanded",f)}function x(){f=!1,p=document.getElementById("color-palette");const e=document.getElementById("color-picker-btn");p&&p.classList.remove("open"),e&&e.setAttribute("aria-expanded","false")}function v(){const e=document.getElementById("color-picker-btn");if(!e)return;const t={default:"var(--color-text-primary)",brand:"var(--color-brand)",red:"#ef4444",orange:"#f97316",amber:"#f59e0b",green:"#22c55e",teal:"#14b8a6",blue:"#3b82f6",indigo:"#6366f1",purple:"#a855f7",pink:"#ec4899",rose:"#f43f5e"};e.style.background=t[a.color]||t.default}function b(){l&&(l.value=JSON.stringify(a))}function m(){n&&(n.querySelectorAll('[data-action="size"]').forEach(e=>{e.classList.toggle("active",e.dataset.size===a.size)}),n.querySelectorAll('[data-action="color"]').forEach(e=>{const t=e.dataset.color===a.color;e.classList.toggle("active",t),e.setAttribute("aria-selected",t)}),n.querySelectorAll('[data-action="align"]').forEach(e=>{e.classList.toggle("active",e.dataset.align===a.align)}))}function u(){o&&(d.forEach(e=>o.classList.remove(`text-${e}`)),s.forEach(e=>o.classList.remove(`color-${e}`)),g.forEach(e=>o.classList.remove(`align-${e}`)),o.classList.add(`text-${a.size}`),o.classList.add(`color-${a.color}`),o.classList.add(`align-${a.align}`))}function I(e){const t=n.querySelectorAll(".formatting-btn, .color-btn, .color-swatch"),r=Array.from(t).indexOf(document.activeElement);switch(e.key){case"ArrowRight":case"ArrowDown":e.preventDefault(),r<t.length-1?t[r+1].focus():t[0].focus();break;case"ArrowLeft":case"ArrowUp":e.preventDefault(),r>0?t[r-1].focus():t[t.length-1].focus();break;case"Escape":x();break}}function h(e){return{default:"Par d\xE9faut",brand:"Cinq",red:"Rouge",orange:"Orange",amber:"Ambre",green:"Vert",teal:"Turquoise",blue:"Bleu",indigo:"Indigo",purple:"Violet",pink:"Rose",rose:"Ros\xE9"}[e]||e}function N(){return{...a}}function q(e){e&&(e.size&&d.includes(e.size)&&(a.size=e.size),e.color&&s.includes(e.color)&&(a.color=e.color),e.align&&g.includes(e.align)&&(a.align=e.align),b(),m(),u(),v())}function O(e,t){!e||!t||(d.forEach(r=>e.classList.remove(`text-${r}`)),s.forEach(r=>e.classList.remove(`color-${r}`)),g.forEach(r=>e.classList.remove(`align-${r}`)),t.size&&e.classList.add(`text-${t.size}`),t.color&&e.classList.add(`color-${t.color}`),t.align&&e.classList.add(`align-${t.align}`))}function M(e){if(!e)return null;try{const t=JSON.parse(e);return{size:d.includes(t.size)?t.size:"normal",color:s.includes(t.color)?t.color:"default",align:g.includes(t.align)?t.align:"left"}}catch{return null}}function P(){a={...y},b(),m(),u(),v()}return{init:k,getFormat:N,setFormat:q,applyToPost:O,parseFormat:M,reset:P,toggleToolbar:w,SIZES:d,COLORS:s,ALIGNMENTS:g,DEFAULT_FORMAT:y}})();document.readyState==="loading"?document.addEventListener("DOMContentLoaded",CinqFormatting.init):setTimeout(CinqFormatting.init,0),window.CinqFormatting=CinqFormatting;
